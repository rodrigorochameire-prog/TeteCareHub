Perfeito! Agora entendemos o problema: as políticas pertencem ao role `supabase_storage_admin`, por isso o DROP/CREATE anterior não funcionou.

**CONFIRMAÇÃO: Pode prosseguir com a Opção 1 (ALTER POLICY).**

Por favor, execute os comandos `ALTER POLICY` para atualizar diretamente as 4 políticas existentes:

**1. staff_policy_select:**
```sql
ALTER POLICY "staff_policy_select" ON storage.objects
USING (
  bucket_id = 'staff'::text 
  AND (
    public.is_admin((SELECT auth.uid()))
    OR
    EXISTS (
      SELECT 1 FROM public.users 
      WHERE users.auth_id = (SELECT auth.uid())
        AND users.id = public.extract_tutor_id_from_path(name)  -- ✅ CORRETO: usa 'name'
    )
  )
);
```

**2. tutors_policy_select:**
```sql
ALTER POLICY "tutors_policy_select" ON storage.objects
USING (
  bucket_id = 'tutors'::text 
  AND (
    public.is_admin((SELECT auth.uid()))
    OR
    EXISTS (
      SELECT 1 FROM public.users 
      WHERE users.auth_id = (SELECT auth.uid())
        AND users.id = public.extract_tutor_id_from_path(name)  -- ✅ CORRETO: usa 'name'
    )
  )
);
```

**3. tutors_policy_insert:**
```sql
ALTER POLICY "tutors_policy_insert" ON storage.objects
WITH CHECK (
  bucket_id = 'tutors'::text 
  AND (
    public.is_admin((SELECT auth.uid()))
    OR
    EXISTS (
      SELECT 1 FROM public.users 
      WHERE users.auth_id = (SELECT auth.uid())
        AND users.id = public.extract_tutor_id_from_path(name)  -- ✅ CORRETO: usa 'name'
    )
  )
);
```

**4. tutors_policy_update:**
```sql
ALTER POLICY "tutors_policy_update" ON storage.objects
USING (
  bucket_id = 'tutors'::text 
  AND (
    public.is_admin((SELECT auth.uid()))
    OR
    EXISTS (
      SELECT 1 FROM public.users 
      WHERE users.auth_id = (SELECT auth.uid())
        AND users.id = public.extract_tutor_id_from_path(name)  -- ✅ CORRETO: usa 'name'
    )
  )
);
```

**Após executar, validar:**
```sql
SELECT 
  p.polname as policy_name,
  pg_get_expr(p.qual, p.polrelid) as stored_using_expression,
  pg_get_expr(p.polwithcheck, p.polrelid) as stored_with_check_expression
FROM pg_policy p
JOIN pg_class c ON c.oid = p.polrelid
WHERE c.relname = 'objects'
  AND c.relnamespace = 'storage'::regnamespace
  AND p.polname IN (
    'staff_policy_select',
    'tutors_policy_select',
    'tutors_policy_insert',
    'tutors_policy_update'
  )
ORDER BY p.polname;
```

**Verificar que:**
- ✅ Todas as expressões usam `extract_tutor_id_from_path(name)` (não `users.name`)
- ❌ Nenhuma expressão contém `users.name`

**Se houver erro de permissão:**
- Me informe a mensagem de erro
- Eu prepararei o script completo para você executar no SQL Editor do Supabase Dashboard (que geralmente tem permissões elevadas)

Pode prosseguir com os 4 comandos ALTER POLICY?


