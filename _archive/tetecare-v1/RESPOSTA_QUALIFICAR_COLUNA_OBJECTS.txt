Perfeito! Agora entendemos o problema: o PostgreSQL está resolvendo `name` como `users.name` dentro da subquery em vez de `storage.objects.name`.

**CONFIRMAÇÃO: Execute a Opção A (qualificar explicitamente como `storage.objects.name`).**

Por favor, execute os comandos `ALTER POLICY` novamente, mas desta vez qualificando explicitamente a coluna `name` da tabela `storage.objects`:

**1. staff_policy_select:**
```sql
ALTER POLICY "staff_policy_select" ON storage.objects
USING (
  bucket_id = 'staff'::text 
  AND (
    public.is_admin((SELECT auth.uid()))
    OR
    EXISTS (
      SELECT 1 FROM public.users 
      WHERE users.auth_id = (SELECT auth.uid())
        AND users.id = public.extract_tutor_id_from_path(storage.objects.name)  -- ✅ CORRETO: qualificado explicitamente
    )
  )
);
```

**2. tutors_policy_select:**
```sql
ALTER POLICY "tutors_policy_select" ON storage.objects
USING (
  bucket_id = 'tutors'::text 
  AND (
    public.is_admin((SELECT auth.uid()))
    OR
    EXISTS (
      SELECT 1 FROM public.users 
      WHERE users.auth_id = (SELECT auth.uid())
        AND users.id = public.extract_tutor_id_from_path(storage.objects.name)  -- ✅ CORRETO: qualificado explicitamente
    )
  )
);
```

**3. tutors_policy_insert:**
```sql
ALTER POLICY "tutors_policy_insert" ON storage.objects
WITH CHECK (
  bucket_id = 'tutors'::text 
  AND (
    public.is_admin((SELECT auth.uid()))
    OR
    EXISTS (
      SELECT 1 FROM public.users 
      WHERE users.auth_id = (SELECT auth.uid())
        AND users.id = public.extract_tutor_id_from_path(storage.objects.name)  -- ✅ CORRETO: qualificado explicitamente
    )
  )
);
```

**4. tutors_policy_update:**
```sql
ALTER POLICY "tutors_policy_update" ON storage.objects
USING (
  bucket_id = 'tutors'::text 
  AND (
    public.is_admin((SELECT auth.uid()))
    OR
    EXISTS (
      SELECT 1 FROM public.users 
      WHERE users.auth_id = (SELECT auth.uid())
        AND users.id = public.extract_tutor_id_from_path(storage.objects.name)  -- ✅ CORRETO: qualificado explicitamente
    )
  )
);
```

**Após executar, validar:**
```sql
SELECT 
  p.polname as policy_name,
  pg_get_expr(p.qual, p.polrelid) as stored_using_expression,
  pg_get_expr(p.polwithcheck, p.polrelid) as stored_with_check_expression
FROM pg_policy p
JOIN pg_class c ON c.oid = p.polrelid
WHERE c.relname = 'objects'
  AND c.relnamespace = 'storage'::regnamespace
  AND p.polname IN (
    'staff_policy_select',
    'tutors_policy_select',
    'tutors_policy_insert',
    'tutors_policy_update'
  )
ORDER BY p.polname;
```

**Verificar que:**
- ✅ Todas as expressões usam `extract_tutor_id_from_path(storage.objects.name)` ou similar
- ❌ Nenhuma expressão contém `extract_tutor_id_from_path(users.name)`

**Nota:** O PostgreSQL pode ainda normalizar para `objects.name` (sem o schema), mas o importante é que NÃO seja `users.name`.

Pode prosseguir com os 4 comandos ALTER POLICY usando `storage.objects.name`?


