Por favor, execute as seguintes ações na ordem:

## 1. CRIAR VIEW users_view (mapear snake_case para camelCase)

Crie uma view que mapeia as colunas snake_case da tabela users para camelCase:

```sql
CREATE OR REPLACE VIEW public.users_view AS
SELECT 
  id,
  auth_id AS "authId",
  open_id AS "openId",
  name,
  email,
  password_hash AS "passwordHash",
  login_method AS "loginMethod",
  email_verified AS "emailVerified",
  role,
  phone,
  stripe_customer_id AS "stripeCustomerId",
  created_at AS "createdAt",
  updated_at AS "updatedAt",
  last_signed_in AS "lastSignedIn"
FROM public.users;
```

## 2. CRIAR TRIGGER para sincronizar auth.users → public.users

Crie um trigger que automaticamente cria/atualiza um registro em `public.users` quando um novo usuário é criado em `auth.users`:

```sql
-- Função do trigger
CREATE OR REPLACE FUNCTION public.handle_new_user()
RETURNS TRIGGER AS $$
BEGIN
  INSERT INTO public.users (
    auth_id,
    email,
    name,
    login_method,
    email_verified,
    role,
    created_at,
    updated_at,
    last_signed_in
  )
  VALUES (
    NEW.id::text,  -- UUID do Supabase Auth convertido para text
    NEW.email,
    COALESCE(NEW.raw_user_meta_data->>'name', NEW.raw_user_meta_data->>'full_name', split_part(NEW.email, '@', 1)),
    'email',
    COALESCE(NEW.email_confirmed_at IS NOT NULL, false),
    'user',
    NOW(),
    NOW(),
    NOW()
  )
  ON CONFLICT (auth_id) 
  DO UPDATE SET
    email = EXCLUDED.email,
    email_verified = EXCLUDED.email_verified,
    last_signed_in = NOW(),
    updated_at = NOW();
  
  RETURN NEW;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

-- Criar o trigger
CREATE TRIGGER on_auth_user_created
  AFTER INSERT OR UPDATE ON auth.users
  FOR EACH ROW
  EXECUTE FUNCTION public.handle_new_user();
```

## 3. VERIFICAR CONFIGURAÇÕES DE AUTH

Confirme que:
- Email provider está habilitado
- Site URL: http://localhost:3000
- Redirect URLs: http://localhost:3000/**
- Forneça instruções finais se algo estiver faltando

## OBSERVAÇÕES

- A view permite que o código continue usando camelCase
- O trigger garante sincronização automática quando usuários se registram
- Se houver erro no trigger, ajuste conforme necessário
- Prefiro manter a view por enquanto (solução mais segura que renomear colunas)

Pode prosseguir com a criação da view e do trigger.


