import{m as ue,r as h,t as i,a as r,j as e,C as c,b as d,d as o,f as m,e as C,h as t,I as u,B as g,o as W,A as z,p as H,q as Q,s as R,v as G,X as xe}from"./index-DG0yx2hi.js";import{A as pe}from"./AdminLayout-CapzJ-JK.js";import{T as O}from"./textarea-BfRN5q_Y.js";import{T as je,a as ge,b as y,c as A}from"./tabs-sUy1g-fW.js";import{S as k,a as _,b as P,c as E,d as a}from"./select-k5kl2mY3.js";import{B as f}from"./popover-Bqiz4euq.js";import{S as ve}from"./user-B4BzRHVK.js";import{M as fe}from"./message-square-COhalQ2E.js";import{S as be}from"./send-BU_qFC5s.js";import{C as Ne}from"./chart-column-B4FPjduw.js";import{P as U}from"./plus-DIKUpKHa.js";import{C as Ce}from"./check-DDByOptX.js";import"./scroll-area-C0S6gB82.js";import"./index-BdQq_4o_.js";import"./layout-dashboard-CC4g-mOh.js";import"./wallet-CKmMh37E.js";import"./users-DD1qYPM2.js";import"./index-r4-iOF84.js";import"./chevron-down-CKVtRMqG.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=ue("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]);function Oe(){const[Z,X]=h.useState("config"),[Ae,$]=h.useState(!1),[J,L]=h.useState(!1),[we,Y]=h.useState(!1),[ee,V]=h.useState(!1),{data:v,refetch:se}=i.whatsapp.getConfig.useQuery(),{data:B=[],refetch:ae}=i.whatsapp.listTemplates.useQuery(),{data:te=[],refetch:q}=i.whatsapp.getMessageHistory.useQuery({limit:50}),{data:Se=[],refetch:Te}=i.whatsapp.listGroups.useQuery(),{data:re=[],refetch:K}=i.whatsapp.listAutomations.useQuery(),{data:b}=i.whatsapp.getStats.useQuery(),S=i.whatsapp.updateConfig.useMutation({onSuccess:()=>{r.success("Configura칞칚o atualizada"),se(),$(!1)},onError:s=>r.error(s.message)}),T=i.whatsapp.createTemplate.useMutation({onSuccess:()=>{r.success("Template criado"),ae(),L(!1)},onError:s=>r.error(s.message)}),I=i.whatsapp.sendMessage.useMutation({onSuccess:()=>{r.success("Mensagem enviada"),q(),Y(!1)},onError:s=>r.error(s.message)});i.whatsapp.sendMedia.useMutation({onSuccess:()=>{r.success("M칤dia enviada"),q()},onError:s=>r.error(s.message)});const M=i.whatsapp.createAutomation.useMutation({onSuccess:()=>{r.success("Automa칞칚o criada"),K(),V(!1)},onError:s=>r.error(s.message)}),ie=i.whatsapp.updateAutomation.useMutation({onSuccess:()=>{r.success("Automa칞칚o atualizada"),K()},onError:s=>r.error(s.message)}),[n,N]=h.useState({apiKey:v?.apiKey||"",phoneNumberId:v?.phoneNumberId||"",businessAccountId:v?.businessAccountId||"",webhookSecret:v?.webhookSecret||"",isActive:v?.isActive||!1}),[l,w]=h.useState({name:"",category:"custom",content:"",variables:""}),[p,D]=h.useState({phone:"",message:"",recipientName:""}),[x,F]=h.useState({name:"",triggerType:"photo_added",templateId:0,enabled:!0}),ne=s=>{s.preventDefault(),S.mutate(n)},le=s=>{s.preventDefault(),T.mutate({...l,variables:l.variables?l.variables.split(",").map(j=>j.trim()):[]})},ce=s=>{s.preventDefault(),I.mutate(p)},de=s=>{if(s.preventDefault(),!x.templateId){r.error("Selecione um template");return}M.mutate(x)},oe=(s,j)=>{ie.mutate({id:s,enabled:!j})},me=s=>{switch(s){case"sent":return"bg-blue-500";case"delivered":return"bg-green-500";case"read":return"bg-purple-500";case"failed":return"bg-red-500";default:return"bg-gray-500"}},he=s=>({photo_added:"Foto Adicionada",vaccine_reminder_7d:"Lembrete Vacina (7 dias)",vaccine_reminder_1d:"Lembrete Vacina (1 dia)",checkin:"Check-in",checkout:"Check-out",daily_report:"Relat칩rio Di치rio",medication_applied:"Medicamento Aplicado",preventive_reminder:"Lembrete Preventivo"})[s]||s;return e.jsx(pe,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Central WhatsApp Business"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Gerencie mensagens autom치ticas, templates e grupos por pet"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsxs(c,{children:[e.jsx(d,{className:"pb-2",children:e.jsx(o,{className:"text-sm font-medium",children:"Total"})}),e.jsx(m,{children:e.jsx("div",{className:"text-2xl font-bold",children:b?.total||0})})]}),e.jsxs(c,{children:[e.jsx(d,{className:"pb-2",children:e.jsx(o,{className:"text-sm font-medium",children:"Enviadas"})}),e.jsx(m,{children:e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:b?.sent||0})})]}),e.jsxs(c,{children:[e.jsx(d,{className:"pb-2",children:e.jsx(o,{className:"text-sm font-medium",children:"Entregues"})}),e.jsx(m,{children:e.jsx("div",{className:"text-2xl font-bold text-green-600",children:b?.delivered||0})})]}),e.jsxs(c,{children:[e.jsx(d,{className:"pb-2",children:e.jsx(o,{className:"text-sm font-medium",children:"Lidas"})}),e.jsx(m,{children:e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:b?.read||0})})]}),e.jsxs(c,{children:[e.jsx(d,{className:"pb-2",children:e.jsx(o,{className:"text-sm font-medium",children:"Falhas"})}),e.jsx(m,{children:e.jsx("div",{className:"text-2xl font-bold text-red-600",children:b?.failed||0})})]})]}),e.jsxs(je,{value:Z,onValueChange:X,children:[e.jsxs(ge,{className:"grid w-full grid-cols-5",children:[e.jsxs(y,{value:"config",children:[e.jsx(ve,{className:"h-4 w-4 mr-2"}),"Configura칞칚o"]}),e.jsxs(y,{value:"templates",children:[e.jsx(fe,{className:"h-4 w-4 mr-2"}),"Templates"]}),e.jsxs(y,{value:"send",children:[e.jsx(be,{className:"h-4 w-4 mr-2"}),"Enviar"]}),e.jsxs(y,{value:"automations",children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),"Automa칞칫es"]}),e.jsxs(y,{value:"history",children:[e.jsx(Ne,{className:"h-4 w-4 mr-2"}),"Hist칩rico"]})]}),e.jsxs(A,{value:"config",className:"space-y-4",children:[e.jsxs(c,{children:[e.jsxs(d,{children:[e.jsx(o,{children:"Configura칞칫es WhatsApp Business API"}),e.jsx(C,{children:"Configure as credenciais da API do WhatsApp Business"})]}),e.jsx(m,{children:e.jsxs("form",{onSubmit:ne,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(t,{htmlFor:"apiKey",children:"API Key"}),e.jsx(u,{id:"apiKey",type:"password",value:n.apiKey,onChange:s=>N({...n,apiKey:s.target.value}),placeholder:"Bearer token da API"})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"phoneNumberId",children:"Phone Number ID"}),e.jsx(u,{id:"phoneNumberId",value:n.phoneNumberId,onChange:s=>N({...n,phoneNumberId:s.target.value}),placeholder:"ID do n칰mero de telefone"})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"businessAccountId",children:"Business Account ID"}),e.jsx(u,{id:"businessAccountId",value:n.businessAccountId,onChange:s=>N({...n,businessAccountId:s.target.value}),placeholder:"ID da conta business"})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"webhookSecret",children:"Webhook Secret (Opcional)"}),e.jsx(u,{id:"webhookSecret",type:"password",value:n.webhookSecret,onChange:s=>N({...n,webhookSecret:s.target.value}),placeholder:"Secret para validar webhooks"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"isActive",checked:n.isActive,onChange:s=>N({...n,isActive:s.target.checked}),className:"h-4 w-4"}),e.jsx(t,{htmlFor:"isActive",children:"Ativar integra칞칚o WhatsApp"})]}),e.jsx(g,{type:"submit",disabled:S.isPending,children:S.isPending?"Salvando...":"Salvar Configura칞칚o"})]})})]}),e.jsxs(c,{children:[e.jsx(d,{children:e.jsx(o,{children:"Status da Integra칞칚o"})}),e.jsx(m,{children:e.jsx("div",{className:"flex items-center space-x-2",children:v?.isActive?e.jsxs(e.Fragment,{children:[e.jsx(f,{className:"bg-green-500",children:"Ativo"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Integra칞칚o WhatsApp est치 funcionando"})]}):e.jsxs(e.Fragment,{children:[e.jsx(f,{className:"bg-gray-500",children:"Inativo"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Configure as credenciais e ative a integra칞칚o"})]})})})]})]}),e.jsxs(A,{value:"templates",className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Templates de Mensagens"}),e.jsxs(W,{open:J,onOpenChange:L,children:[e.jsx(z,{asChild:!0,children:e.jsxs(g,{children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Novo Template"]})}),e.jsxs(H,{children:[e.jsxs(Q,{children:[e.jsx(R,{children:"Criar Template"}),e.jsx(G,{children:"Crie um template de mensagem reutiliz치vel"})]}),e.jsxs("form",{onSubmit:le,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(t,{htmlFor:"templateName",children:"Nome"}),e.jsx(u,{id:"templateName",value:l.name,onChange:s=>w({...l,name:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"category",children:"Categoria"}),e.jsxs(k,{value:l.category,onValueChange:s=>w({...l,category:s}),children:[e.jsx(_,{children:e.jsx(P,{})}),e.jsxs(E,{children:[e.jsx(a,{value:"welcome",children:"Boas-vindas"}),e.jsx(a,{value:"booking_confirmation",children:"Confirma칞칚o de Reserva"}),e.jsx(a,{value:"vaccine_reminder",children:"Lembrete de Vacina"}),e.jsx(a,{value:"checkin",children:"Check-in"}),e.jsx(a,{value:"checkout",children:"Check-out"}),e.jsx(a,{value:"daily_report",children:"Relat칩rio Di치rio"}),e.jsx(a,{value:"new_photo",children:"Nova Foto"}),e.jsx(a,{value:"medication_applied",children:"Medicamento Aplicado"}),e.jsx(a,{value:"preventive_reminder",children:"Lembrete Preventivo"}),e.jsx(a,{value:"custom",children:"Personalizado"})]})]})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"content",children:"Conte칰do"}),e.jsx(O,{id:"content",value:l.content,onChange:s=>w({...l,content:s.target.value}),rows:4,placeholder:"Use {{variavel}} para vari치veis din칙micas",required:!0})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"variables",children:"Vari치veis (separadas por v칤rgula)"}),e.jsx(u,{id:"variables",value:l.variables,onChange:s=>w({...l,variables:s.target.value}),placeholder:"petName, date, time"})]}),e.jsx(g,{type:"submit",disabled:T.isPending,children:T.isPending?"Criando...":"Criar Template"})]})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:B.map(s=>e.jsxs(c,{children:[e.jsx(d,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx(o,{className:"text-lg",children:s.name}),e.jsx(C,{children:s.category})]}),e.jsx(f,{variant:s.status==="active"?"default":"secondary",children:s.status})]})}),e.jsxs(m,{children:[e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:s.content}),s.variables&&Array.isArray(s.variables)&&s.variables.length>0?e.jsxs("div",{className:"mt-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Vari치veis: "}),s.variables.map(j=>e.jsx(f,{variant:"outline",className:"mr-1",children:j},j))]}):null]})]},s.id))})]}),e.jsx(A,{value:"send",className:"space-y-4",children:e.jsxs(c,{children:[e.jsxs(d,{children:[e.jsx(o,{children:"Enviar Mensagem Manual"}),e.jsx(C,{children:"Envie uma mensagem de texto para um tutor"})]}),e.jsx(m,{children:e.jsxs("form",{onSubmit:ce,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(t,{htmlFor:"phone",children:"Telefone (com c칩digo do pa칤s)"}),e.jsx(u,{id:"phone",value:p.phone,onChange:s=>D({...p,phone:s.target.value}),placeholder:"+5511999999999",required:!0})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"recipientName",children:"Nome do Destinat치rio (Opcional)"}),e.jsx(u,{id:"recipientName",value:p.recipientName,onChange:s=>D({...p,recipientName:s.target.value}),placeholder:"Nome do tutor"})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"message",children:"Mensagem"}),e.jsx(O,{id:"message",value:p.message,onChange:s=>D({...p,message:s.target.value}),rows:4,required:!0})]}),e.jsx(g,{type:"submit",disabled:I.isPending,children:I.isPending?"Enviando...":"Enviar Mensagem"})]})})]})}),e.jsxs(A,{value:"automations",className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Automa칞칫es"}),e.jsxs(W,{open:ee,onOpenChange:V,children:[e.jsx(z,{asChild:!0,children:e.jsxs(g,{children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Nova Automa칞칚o"]})}),e.jsxs(H,{children:[e.jsxs(Q,{children:[e.jsx(R,{children:"Criar Automa칞칚o"}),e.jsx(G,{children:"Configure uma automa칞칚o de mensagens"})]}),e.jsxs("form",{onSubmit:de,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(t,{htmlFor:"automationName",children:"Nome"}),e.jsx(u,{id:"automationName",value:x.name,onChange:s=>F({...x,name:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"triggerType",children:"Gatilho"}),e.jsxs(k,{value:x.triggerType,onValueChange:s=>F({...x,triggerType:s}),children:[e.jsx(_,{children:e.jsx(P,{})}),e.jsxs(E,{children:[e.jsx(a,{value:"photo_added",children:"Foto Adicionada"}),e.jsx(a,{value:"vaccine_reminder_7d",children:"Lembrete Vacina (7 dias)"}),e.jsx(a,{value:"vaccine_reminder_1d",children:"Lembrete Vacina (1 dia)"}),e.jsx(a,{value:"checkin",children:"Check-in"}),e.jsx(a,{value:"checkout",children:"Check-out"}),e.jsx(a,{value:"daily_report",children:"Relat칩rio Di치rio"}),e.jsx(a,{value:"medication_applied",children:"Medicamento Aplicado"}),e.jsx(a,{value:"preventive_reminder",children:"Lembrete Preventivo"})]})]})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"templateId",children:"Template"}),e.jsxs(k,{value:x.templateId.toString(),onValueChange:s=>F({...x,templateId:parseInt(s)}),children:[e.jsx(_,{children:e.jsx(P,{placeholder:"Selecione um template"})}),e.jsx(E,{children:B.filter(s=>s.status==="active").map(s=>e.jsx(a,{value:s.id.toString(),children:s.name},s.id))})]})]}),e.jsx(g,{type:"submit",disabled:M.isPending,children:M.isPending?"Criando...":"Criar Automa칞칚o"})]})]})]})]}),e.jsx("div",{className:"space-y-4",children:re.map(s=>e.jsxs(c,{children:[e.jsx(d,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx(o,{className:"text-lg",children:s.name}),e.jsx(C,{children:he(s.triggerType)})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(f,{variant:s.enabled?"default":"secondary",children:s.enabled?"Ativo":"Inativo"}),e.jsx(g,{size:"sm",variant:"ghost",onClick:()=>oe(s.id,s.enabled),children:s.enabled?e.jsx(xe,{className:"h-4 w-4"}):e.jsx(Ce,{className:"h-4 w-4"})})]})]})}),e.jsx(m,{children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Template: ",s.templateName||`ID ${s.templateId}`]})})]},s.id))})]}),e.jsx(A,{value:"history",className:"space-y-4",children:e.jsxs(c,{children:[e.jsxs(d,{children:[e.jsx(o,{children:"Hist칩rico de Mensagens"}),e.jsx(C,{children:"칔ltimas 50 mensagens enviadas"})]}),e.jsx(m,{children:e.jsx("div",{className:"space-y-2",children:te.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"font-medium",children:s.recipientName||s.recipientPhone}),e.jsx(f,{className:me(s.status),children:s.status})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s.messageContent}),s.mediaUrl&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"游늹 M칤dia anexada"})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s.sentAt?new Date(s.sentAt).toLocaleString("pt-BR"):"Aguardando"})]},s.id))})})]})})]})]})})}export{Oe as default};
