import{r as N,t as f,j as e,C as d,b as x,d as m,S as T,f as p,i as C,c as z,e as O,I as U}from"./index-DG0yx2hi.js";import{A as q}from"./AdminLayout-CapzJ-JK.js";import{B as g}from"./popover-Bqiz4euq.js";import{S,a as D,b as P,c as I,d as l}from"./select-k5kl2mY3.js";import{T as G,a as J,b as B,c as r,d as K,e as n}from"./table-DeOYaLOA.js";import{R as W}from"./RecentChangeIndicator-dH2jnUR2.js";import{S as X}from"./search-DtaYG9vz.js";import"./scroll-area-C0S6gB82.js";import"./index-BdQq_4o_.js";import"./layout-dashboard-CC4g-mOh.js";import"./wallet-CKmMh37E.js";import"./users-DD1qYPM2.js";import"./user-B4BzRHVK.js";import"./index-r4-iOF84.js";import"./chevron-down-CKVtRMqG.js";import"./check-DDByOptX.js";import"./clock-BQzFMz2h.js";function je(){const[v,L]=N.useState(""),[u,R]=N.useState("all"),[i,V]=N.useState("all"),{data:w}=f.pets.list.useQuery(),{data:y}=f.changeHistory.getRecentChanges.useQuery({limit:200}),F=w?.map(t=>{const{data:s}=f.flea.list.useQuery({petId:t.id});return{pet:t,treatments:s||[],type:"flea"}}).filter(Boolean)||[],E=w?.map(t=>{const{data:s}=f.deworming.list.useQuery({petId:t.id});return{pet:t,treatments:s||[],type:"deworming"}}).filter(Boolean)||[],o=[...F.flatMap(({pet:t,treatments:s})=>s.map(a=>({id:a.id,petName:t.name,petId:t.id,type:"Antipulgas",product:a.productName,lastApplication:a.applicationDate,nextApplication:a.nextDueDate,notes:a.notes}))),...E.flatMap(({pet:t,treatments:s})=>s.map(a=>({id:a.id,petName:t.name,petId:t.id,type:"Vermífugo",product:a.productName,lastApplication:a.applicationDate,nextApplication:a.nextDueDate,notes:a.notes})))],h=t=>t?new Date(t)<new Date:!1,j=t=>{if(!t)return!1;const s=new Date(t),a=new Date,c=new Date;return c.setDate(a.getDate()+7),s>=a&&s<=c},A=o.filter(t=>{const s=t.petName.toLowerCase().includes(v.toLowerCase())||t.product.toLowerCase().includes(v.toLowerCase()),a=u==="all"||u==="flea"&&t.type==="Antipulgas"||u==="deworming"&&t.type==="Vermífugo",c=h(t.nextApplication),b=j(t.nextApplication);return s&&a&&(i==="all"||i==="overdue"&&c||i==="upcoming"&&b||i==="active"&&(!c&&!b))}),H=o.length,Q=o.filter(t=>h(t.nextApplication)).length,k=o.filter(t=>j(t.nextApplication)).length,M=o.filter(t=>!h(t.nextApplication)&&!j(t.nextApplication)).length,$=t=>y?y.filter(s=>s.resourceId===t&&(s.resourceType==="flea"||s.resourceType==="deworming")):[];return e.jsx(q,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Todos os Preventivos"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Visualize e gerencie tratamentos antipulgas e vermífugos de todos os pets"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs(d,{children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"Total"}),e.jsx(T,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(p,{children:[e.jsx("div",{className:"text-2xl font-bold",children:H}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Tratamentos registrados"})]})]}),e.jsxs(d,{children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"Atrasados"}),e.jsx(C,{className:"h-4 w-4 text-red-500"})]}),e.jsxs(p,{children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:Q}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Necessitam aplicação"})]})]}),e.jsxs(d,{children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"Próximos (7 dias)"}),e.jsx(C,{className:"h-4 w-4 text-orange-500"})]}),e.jsxs(p,{children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:k}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Aplicação em breve"})]})]}),e.jsxs(d,{children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"Em Dia"}),e.jsx(z,{className:"h-4 w-4 text-green-500"})]}),e.jsxs(p,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:M}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Próxima aplicação agendada"})]})]})]}),e.jsxs(d,{children:[e.jsxs(x,{children:[e.jsx(m,{children:"Tratamentos Preventivos"}),e.jsx(O,{children:"Lista completa de antipulgas e vermífugos de todos os pets"})]}),e.jsxs(p,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(X,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(U,{placeholder:"Buscar por pet ou produto...",value:v,onChange:t=>L(t.target.value),className:"pl-10"})]}),e.jsxs(S,{value:u,onValueChange:R,children:[e.jsx(D,{className:"w-full md:w-48",children:e.jsx(P,{placeholder:"Tipo"})}),e.jsxs(I,{children:[e.jsx(l,{value:"all",children:"Todos os tipos"}),e.jsx(l,{value:"flea",children:"Antipulgas"}),e.jsx(l,{value:"deworming",children:"Vermífugo"})]})]}),e.jsxs(S,{value:i,onValueChange:V,children:[e.jsx(D,{className:"w-full md:w-48",children:e.jsx(P,{placeholder:"Status"})}),e.jsxs(I,{children:[e.jsx(l,{value:"all",children:"Todos os status"}),e.jsx(l,{value:"overdue",children:"Atrasados"}),e.jsx(l,{value:"upcoming",children:"Próximos (7 dias)"}),e.jsx(l,{value:"active",children:"Em dia"})]})]})]}),A.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(T,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-lg font-medium",children:"Nenhum tratamento encontrado"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ajuste os filtros ou adicione tratamentos preventivos aos pets"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(G,{children:[e.jsx(J,{children:e.jsxs(B,{children:[e.jsx(r,{children:"Pet"}),e.jsx(r,{children:"Tipo"}),e.jsx(r,{children:"Produto"}),e.jsx(r,{children:"Última Aplicação"}),e.jsx(r,{children:"Próxima Aplicação"}),e.jsx(r,{children:"Status"}),e.jsx(r,{children:"Alterações"})]})}),e.jsx(K,{children:A.map(t=>{const s=h(t.nextApplication),a=j(t.nextApplication);return e.jsxs(B,{children:[e.jsx(n,{className:"font-medium",children:t.petName}),e.jsx(n,{children:e.jsx(g,{variant:"outline",children:t.type})}),e.jsx(n,{children:t.product}),e.jsx(n,{children:new Date(t.lastApplication).toLocaleDateString("pt-BR")}),e.jsx(n,{children:t.nextApplication?new Date(t.nextApplication).toLocaleDateString("pt-BR"):"-"}),e.jsxs(n,{children:[s&&e.jsx(g,{variant:"destructive",children:"Atrasado"}),a&&!s&&e.jsx(g,{className:"bg-orange-100 text-orange-700 border-orange-200",children:"Próximo"}),!s&&!a&&e.jsx(g,{variant:"default",className:"bg-green-100 text-green-700 border-green-200",children:"Em dia"})]}),e.jsx(n,{children:e.jsx(W,{changes:$(t.id),resourceType:"preventive"})})]},`${t.type}-${t.id}`)})})]})})]})]})]})})}export{je as default};
