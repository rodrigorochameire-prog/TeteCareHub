import{r as l,t as m,a as h,j as e,C as H,b as R,d as z,e as k,o as _,A as De,B as d,p as Q,q as U,s as G,v as $,h as o,I as x,w as J,f as K}from"./index-DG0yx2hi.js";import{A as Te}from"./AdminLayout-CapzJ-JK.js";import{T as q}from"./textarea-BfRN5q_Y.js";import{T as Se,a as we,b as W,c as X}from"./tabs-sUy1g-fW.js";import{S as j,a as p,b as g,c as f,d as t}from"./select-k5kl2mY3.js";import{T as Y,a as Z,b,c as i,d as ee,e as r}from"./table-DeOYaLOA.js";import{P as D,B as se}from"./popover-Bqiz4euq.js";import{R as Ce}from"./RecentChangeIndicator-dH2jnUR2.js";import{H as Ae}from"./history-BxnlJaOb.js";import{P as Me}from"./plus-DIKUpKHa.js";import{S as Fe}from"./search-DtaYG9vz.js";import{F as T}from"./filter-C966fxzX.js";import{S as Ie}from"./square-pen-D7F5zf6L.js";import{T as qe}from"./trash-2-6I2MbiK3.js";import"./scroll-area-C0S6gB82.js";import"./index-BdQq_4o_.js";import"./layout-dashboard-CC4g-mOh.js";import"./wallet-CKmMh37E.js";import"./users-DD1qYPM2.js";import"./user-B4BzRHVK.js";import"./index-r4-iOF84.js";import"./chevron-down-CKVtRMqG.js";import"./check-DDByOptX.js";import"./clock-BQzFMz2h.js";function rs(){const[ae,te]=l.useState("library"),[ie,S]=l.useState(!1),[E,re]=l.useState(""),[w,ne]=l.useState(""),[C,le]=l.useState("all"),[A,oe]=l.useState("all"),[u,ce]=l.useState("all"),[M,de]=l.useState("all"),[c,P]=l.useState(null),[me,v]=l.useState(!1),{data:F,refetch:he}=m.medications.library.useQuery(),{data:B,refetch:L}=m.pets.list.useQuery(),{data:xe}=m.changeHistory.getRecentChanges.useQuery({limit:200}),ue=m.medications.addToLibrary.useMutation({onSuccess:()=>{h.success("Medicamento adicionado à biblioteca!"),S(!1),he()},onError:s=>{h.error(s.message||"Erro ao adicionar medicamento")}}),je=m.medications.update.useMutation({onSuccess:()=>{h.success("Medicamento atualizado!"),v(!1),P(null),L()},onError:s=>{h.error(s.message||"Erro ao atualizar medicamento")}}),pe=m.medications.delete.useMutation({onSuccess:()=>{h.success("Medicamento removido!"),L()},onError:s=>{h.error(s.message||"Erro ao remover medicamento")}}),ge=s=>{s.preventDefault();const a=new FormData(s.currentTarget);ue.mutate({name:a.get("name"),type:E,description:a.get("description")||void 0,commonDosage:a.get("commonDosage")||void 0})},fe=s=>{s.preventDefault();const a=new FormData(s.currentTarget),n=a.get("startDate"),y=a.get("endDate");je.mutate({id:c.id,petId:c.petId,dosage:a.get("dosage"),frequency:a.get("frequency"),startDate:n?new Date(n):void 0,endDate:y?new Date(y):void 0,notes:a.get("notes")||void 0})},ve=(s,a)=>{confirm("Tem certeza que deseja remover este medicamento?")&&pe.mutate({id:s,petId:a})},V=(B?.flatMap(s=>(s.medications||[]).map(a=>({...a,petName:s.name,petId:s.id})))||[]).filter(s=>{const a=s.medication?.name?.toLowerCase().includes(w.toLowerCase())||s.petName.toLowerCase().includes(w.toLowerCase()),n=C==="all"||s.status===C,y=A==="all"||s.medication?.type===A,Ne=M==="all"||s.petId.toString()===M;let N=!0;if(u!=="all"&&s.startDate){const be=new Date(s.startDate),I=Math.floor((new Date().getTime()-be.getTime())/(1e3*60*60*24));u==="7days"?N=I<=7:u==="30days"?N=I<=30:u==="90days"&&(N=I<=90)}return a&&n&&y&&Ne&&N}),ye=s=>{const a={active:"default",completed:"secondary",suspended:"destructive"},n={active:"Ativo",completed:"Concluído",suspended:"Suspenso"};return e.jsx(se,{variant:a[s]||"outline",children:n[s]||s})},O=s=>{const a={antibiotic:"default",anti_inflammatory:"secondary",antiparasitic:"outline",supplement:"outline",other:"outline"},n={antibiotic:"Antibiótico",anti_inflammatory:"Anti-inflamatório",antiparasitic:"Antiparasitário",supplement:"Suplemento",other:"Outro"};return e.jsx(se,{variant:a[s]||"outline",children:n[s]||s})};return e.jsx(Te,{children:e.jsxs("div",{className:"container py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold",children:"Medicamentos"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Gerencie a biblioteca de medicamentos e tratamentos ativos"})]}),e.jsx(D,{className:"h-12 w-12 text-primary"})]}),e.jsxs(Se,{value:ae,onValueChange:te,className:"space-y-6",children:[e.jsxs(we,{className:"grid w-full grid-cols-2 max-w-md",children:[e.jsxs(W,{value:"library",children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),"Biblioteca"]}),e.jsxs(W,{value:"treatments",children:[e.jsx(Ae,{className:"h-4 w-4 mr-2"}),"Tratamentos Ativos"]})]}),e.jsx(X,{value:"library",className:"space-y-6",children:e.jsxs(H,{children:[e.jsx(R,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(z,{children:"Biblioteca de Medicamentos"}),e.jsx(k,{children:"Medicamentos pré-cadastrados para uso rápido"})]}),e.jsxs(_,{open:ie,onOpenChange:S,children:[e.jsx(De,{asChild:!0,children:e.jsxs(d,{children:[e.jsx(Me,{className:"h-4 w-4 mr-2"}),"Adicionar Medicamento"]})}),e.jsx(Q,{children:e.jsxs("form",{onSubmit:ge,children:[e.jsxs(U,{children:[e.jsx(G,{children:"Adicionar Medicamento à Biblioteca"}),e.jsx($,{children:"Cadastre um novo medicamento para uso futuro"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"name",children:"Nome do Medicamento *"}),e.jsx(x,{id:"name",name:"name",placeholder:"Ex: Amoxicilina",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"type",children:"Tipo *"}),e.jsxs(j,{value:E,onValueChange:re,required:!0,children:[e.jsx(p,{children:e.jsx(g,{placeholder:"Selecione o tipo"})}),e.jsxs(f,{children:[e.jsx(t,{value:"antibiotic",children:"Antibiótico"}),e.jsx(t,{value:"anti_inflammatory",children:"Anti-inflamatório"}),e.jsx(t,{value:"antiparasitic",children:"Antiparasitário"}),e.jsx(t,{value:"supplement",children:"Suplemento"}),e.jsx(t,{value:"other",children:"Outro"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"description",children:"Descrição"}),e.jsx(q,{id:"description",name:"description",placeholder:"Descrição do medicamento...",rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"dosageInfo",children:"Informações de Dosagem"}),e.jsx(q,{id:"dosageInfo",name:"dosageInfo",placeholder:"Ex: 10mg/kg a cada 12 horas",rows:2})]})]}),e.jsxs(J,{children:[e.jsx(d,{type:"button",variant:"outline",onClick:()=>S(!1),children:"Cancelar"}),e.jsx(d,{type:"submit",children:"Adicionar"})]})]})})]})]})}),e.jsx(K,{children:!F||F.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(D,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Nenhum medicamento cadastrado na biblioteca"})]}):e.jsxs(Y,{children:[e.jsx(Z,{children:e.jsxs(b,{children:[e.jsx(i,{children:"Nome"}),e.jsx(i,{children:"Tipo"}),e.jsx(i,{children:"Descrição"}),e.jsx(i,{children:"Dosagem"})]})}),e.jsx(ee,{children:F.map(s=>e.jsxs(b,{children:[e.jsx(r,{className:"font-medium",children:s.name}),e.jsx(r,{children:O(s.type)}),e.jsx(r,{className:"max-w-xs truncate",children:s.description||"-"}),e.jsx(r,{className:"text-sm text-muted-foreground",children:s.dosageInfo||"-"})]},s.id))})]})})]})}),e.jsx(X,{value:"treatments",className:"space-y-6",children:e.jsxs(H,{children:[e.jsxs(R,{children:[e.jsx(z,{children:"Tratamentos Ativos"}),e.jsx(k,{children:"Todos os medicamentos em uso pelos pets"})]}),e.jsxs(K,{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsx("div",{className:"flex-1 min-w-[200px]",children:e.jsxs("div",{className:"relative",children:[e.jsx(Fe,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(x,{placeholder:"Buscar por medicamento ou pet...",value:w,onChange:s=>ne(s.target.value),className:"pl-10"})]})}),e.jsxs(j,{value:C,onValueChange:le,children:[e.jsxs(p,{className:"w-[180px]",children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),e.jsx(g,{})]}),e.jsxs(f,{children:[e.jsx(t,{value:"all",children:"Todos os Status"}),e.jsx(t,{value:"active",children:"Ativo"}),e.jsx(t,{value:"completed",children:"Concluído"}),e.jsx(t,{value:"suspended",children:"Suspenso"})]})]}),e.jsxs(j,{value:A,onValueChange:oe,children:[e.jsxs(p,{className:"w-[180px]",children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),e.jsx(g,{})]}),e.jsxs(f,{children:[e.jsx(t,{value:"all",children:"Todos os Tipos"}),e.jsx(t,{value:"antibiotic",children:"Antibiótico"}),e.jsx(t,{value:"anti_inflammatory",children:"Anti-inflamatório"}),e.jsx(t,{value:"antiparasitic",children:"Antiparasitário"}),e.jsx(t,{value:"supplement",children:"Suplemento"}),e.jsx(t,{value:"other",children:"Outro"})]})]}),e.jsxs(j,{value:u,onValueChange:ce,children:[e.jsxs(p,{className:"w-[180px]",children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),e.jsx(g,{})]}),e.jsxs(f,{children:[e.jsx(t,{value:"all",children:"Todos os Períodos"}),e.jsx(t,{value:"7days",children:"Últimos 7 dias"}),e.jsx(t,{value:"30days",children:"Últimos 30 dias"}),e.jsx(t,{value:"90days",children:"Últimos 90 dias"})]})]}),e.jsxs(j,{value:M,onValueChange:de,children:[e.jsxs(p,{className:"w-[180px]",children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),e.jsx(g,{})]}),e.jsxs(f,{children:[e.jsx(t,{value:"all",children:"Todos os Pets"}),B?.map(s=>e.jsx(t,{value:s.id.toString(),children:s.name},s.id))]})]})]}),V.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(D,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Nenhum tratamento encontrado"})]}):e.jsxs(Y,{children:[e.jsx(Z,{children:e.jsxs(b,{children:[e.jsx(i,{children:"Pet"}),e.jsx(i,{children:"Medicamento"}),e.jsx(i,{children:"Tipo"}),e.jsx(i,{children:"Dosagem"}),e.jsx(i,{children:"Frequência"}),e.jsx(i,{children:"Período"}),e.jsx(i,{children:"Status"}),e.jsx(i,{className:"text-right",children:"Ações"})]})}),e.jsx(ee,{children:V.map(s=>{const a=xe?.find(n=>n.entityType==="medication"&&n.entityId===s.id);return e.jsxs(b,{children:[e.jsx(r,{className:"font-medium",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[s.petName,a?e.jsx(Ce,{changes:[a],resourceType:"medication"}):null]})}),e.jsx(r,{children:s.medication?.name||"-"}),e.jsx(r,{children:O(s.medication?.type)}),e.jsx(r,{children:s.dosage}),e.jsx(r,{children:s.frequency}),e.jsxs(r,{className:"text-sm",children:[new Date(s.startDate).toLocaleDateString("pt-BR"),s.endDate&&` - ${new Date(s.endDate).toLocaleDateString("pt-BR")}`]}),e.jsx(r,{children:ye(s.status)}),e.jsx(r,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(d,{size:"sm",variant:"outline",onClick:()=>{P(s),v(!0)},children:e.jsx(Ie,{className:"h-4 w-4"})}),e.jsx(d,{size:"sm",variant:"destructive",onClick:()=>ve(s.id,s.petId),children:e.jsx(qe,{className:"h-4 w-4"})})]})})]},s.id)})})]})]})]})})]}),e.jsx(_,{open:me,onOpenChange:v,children:e.jsx(Q,{children:e.jsxs("form",{onSubmit:fe,children:[e.jsxs(U,{children:[e.jsx(G,{children:"Editar Medicamento"}),e.jsx($,{children:"Atualize as informações do tratamento"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"edit-dosage",children:"Dosagem *"}),e.jsx(x,{id:"edit-dosage",name:"dosage",defaultValue:c?.dosage,placeholder:"Ex: 10mg",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"edit-frequency",children:"Frequência *"}),e.jsx(x,{id:"edit-frequency",name:"frequency",defaultValue:c?.frequency,placeholder:"Ex: A cada 12 horas",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"edit-startDate",children:"Data de Início *"}),e.jsx(x,{id:"edit-startDate",name:"startDate",type:"date",defaultValue:c?.startDate?.split("T")[0],required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"edit-endDate",children:"Data de Término"}),e.jsx(x,{id:"edit-endDate",name:"endDate",type:"date",defaultValue:c?.endDate?.split("T")[0]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"edit-notes",children:"Observações"}),e.jsx(q,{id:"edit-notes",name:"notes",defaultValue:c?.notes,placeholder:"Observações sobre o tratamento...",rows:3})]})]}),e.jsxs(J,{children:[e.jsx(d,{type:"button",variant:"outline",onClick:()=>v(!1),children:"Cancelar"}),e.jsx(d,{type:"submit",children:"Salvar Alterações"})]})]})})})]})})}export{rs as default};
