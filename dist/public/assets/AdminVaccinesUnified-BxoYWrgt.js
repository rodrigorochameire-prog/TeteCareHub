import{r as c,t as x,a as u,j as e,C as h,b as j,d as p,e as H,o as q,A as ve,B as r,p as M,q as Q,s as U,v as G,h as d,I as D,w as J,f as g,i as Ne}from"./index-DG0yx2hi.js";import{A as ye}from"./AdminLayout-CapzJ-JK.js";import{T as K}from"./textarea-BfRN5q_Y.js";import{T as be,a as we,b as W,c as X}from"./tabs-sUy1g-fW.js";import{S as Y,a as Z,b as _,c as $,d as f}from"./select-k5kl2mY3.js";import{T as ee,a as ae,b as V,c as i,d as se,e as n}from"./table-DeOYaLOA.js";import{S as A,B as v}from"./popover-Bqiz4euq.js";import{R as Te}from"./RecentChangeIndicator-dH2jnUR2.js";import{H as Ce}from"./history-BxnlJaOb.js";import{P as Se}from"./plus-DIKUpKHa.js";import{S as Ve}from"./search-DtaYG9vz.js";import{F as te}from"./filter-C966fxzX.js";import{S as Ae}from"./square-pen-D7F5zf6L.js";import{T as Fe}from"./trash-2-6I2MbiK3.js";import"./scroll-area-C0S6gB82.js";import"./index-BdQq_4o_.js";import"./layout-dashboard-CC4g-mOh.js";import"./wallet-CKmMh37E.js";import"./users-DD1qYPM2.js";import"./user-B4BzRHVK.js";import"./index-r4-iOF84.js";import"./chevron-down-CKVtRMqG.js";import"./check-DDByOptX.js";import"./clock-BQzFMz2h.js";function aa(){const[ie,ne]=c.useState("library"),[re,F]=c.useState(!1),[E,le]=c.useState(""),[l,b]=c.useState("all"),[N,ce]=c.useState("all"),[I,oe]=c.useState("all"),[o,z]=c.useState(null),[de,w]=c.useState(!1),{data:P,refetch:me}=x.vaccines.library.useQuery(),{data:O,refetch:R}=x.pets.list.useQuery(),{data:xe}=x.changeHistory.getRecentChanges.useQuery({limit:200}),ue=x.vaccines.addToLibrary.useMutation({onSuccess:()=>{u.success("Vacina adicionada à biblioteca!"),F(!1),me()},onError:a=>{u.error(a.message||"Erro ao adicionar vacina")}}),he=x.vaccines.update.useMutation({onSuccess:()=>{u.success("Vacinação atualizada!"),w(!1),z(null),R()},onError:a=>{u.error(a.message||"Erro ao atualizar vacinação")}}),je=x.vaccines.delete.useMutation({onSuccess:()=>{u.success("Vacinação removida!"),R()},onError:a=>{u.error(a.message||"Erro ao remover vacinação")}}),pe=a=>{a.preventDefault();const s=new FormData(a.currentTarget);ue.mutate({name:s.get("name"),description:s.get("description")||void 0,intervalDays:s.get("intervalDays")?parseInt(s.get("intervalDays")):void 0,dosesRequired:1})},De=a=>{a.preventDefault();const s=new FormData(a.currentTarget),t=s.get("nextDueDate");he.mutate({id:o.id,petId:o.petId,nextDueDate:t?new Date(t):void 0,veterinarian:s.get("veterinarian")||void 0,clinic:s.get("clinic")||void 0,notes:s.get("notes")||void 0})},ge=(a,s)=>{confirm("Tem certeza que deseja remover esta vacinação?")&&je.mutate({id:a,petId:s})},y=O?.flatMap(a=>(a.vaccinations||[]).map(s=>({...s,petName:a.name,petId:a.id})))||[],k=y.filter(a=>{const s=a.vaccine?.name?.toLowerCase().includes(E.toLowerCase())||a.petName.toLowerCase().includes(E.toLowerCase());let t=!0;if(l==="overdue")t=a.nextDueDate&&new Date(a.nextDueDate)<new Date;else if(l==="upcoming"){const m=new Date,S=new Date(m.getTime()+720*60*60*1e3);t=a.nextDueDate&&new Date(a.nextDueDate)>=m&&new Date(a.nextDueDate)<=S}else if(l==="uptodate"){const m=new Date,S=new Date(m.getTime()+720*60*60*1e3);t=!a.nextDueDate||new Date(a.nextDueDate)>S}const L=I==="all"||a.petId.toString()===I;let C=!0;if(N!=="all"&&a.applicationDate){const m=new Date(a.applicationDate),B=Math.floor((new Date().getTime()-m.getTime())/(1e3*60*60*24));N==="7days"?C=B<=7:N==="30days"?C=B<=30:N==="90days"&&(C=B<=90)}return s&&t&&L&&C}),T={total:y.length,overdue:y.filter(a=>a.nextDueDate&&new Date(a.nextDueDate)<new Date).length,upcoming:y.filter(a=>{if(!a.nextDueDate)return!1;const s=new Date,t=new Date(s.getTime()+720*60*60*1e3);return new Date(a.nextDueDate)>=s&&new Date(a.nextDueDate)<=t}).length,uptodate:y.filter(a=>{if(!a.nextDueDate)return!0;const s=new Date(new Date().getTime()+720*60*60*1e3);return new Date(a.nextDueDate)>s}).length},fe=a=>{if(!a)return e.jsx(v,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:"Em dia"});const s=new Date,t=new Date(a),L=new Date(s.getTime()+720*60*60*1e3);return t<s?e.jsx(v,{variant:"destructive",children:"Atrasada"}):t<=L?e.jsx(v,{variant:"default",className:"bg-orange-500",children:"Próxima (30 dias)"}):e.jsx(v,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:"Em dia"})};return e.jsx(ye,{children:e.jsxs("div",{className:"container py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold",children:"Vacinas"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Gerencie a biblioteca de vacinas e aplicações"})]}),e.jsx(A,{className:"h-12 w-12 text-primary"})]}),e.jsxs(be,{value:ie,onValueChange:ne,className:"space-y-6",children:[e.jsxs(we,{className:"grid w-full grid-cols-2 max-w-md",children:[e.jsxs(W,{value:"library",children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),"Biblioteca"]}),e.jsxs(W,{value:"applications",children:[e.jsx(Ce,{className:"h-4 w-4 mr-2"}),"Aplicações"]})]}),e.jsx(X,{value:"library",className:"space-y-6",children:e.jsxs(h,{children:[e.jsx(j,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(p,{children:"Biblioteca de Vacinas"}),e.jsx(H,{children:"Vacinas pré-cadastradas para uso rápido"})]}),e.jsxs(q,{open:re,onOpenChange:F,children:[e.jsx(ve,{asChild:!0,children:e.jsxs(r,{children:[e.jsx(Se,{className:"h-4 w-4 mr-2"}),"Adicionar Vacina"]})}),e.jsx(M,{children:e.jsxs("form",{onSubmit:pe,children:[e.jsxs(Q,{children:[e.jsx(U,{children:"Adicionar Vacina à Biblioteca"}),e.jsx(G,{children:"Cadastre uma nova vacina para uso futuro"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"name",children:"Nome da Vacina *"}),e.jsx(D,{id:"name",name:"name",placeholder:"Ex: V10, Antirrábica",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"description",children:"Descrição"}),e.jsx(K,{id:"description",name:"description",placeholder:"Descrição da vacina e o que protege...",rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"intervalDays",children:"Intervalo Recomendado (dias)"}),e.jsx(D,{id:"intervalDays",name:"intervalDays",type:"number",placeholder:"Ex: 365 (anual)"})]})]}),e.jsxs(J,{children:[e.jsx(r,{type:"button",variant:"outline",onClick:()=>F(!1),children:"Cancelar"}),e.jsx(r,{type:"submit",children:"Adicionar"})]})]})})]})]})}),e.jsx(g,{children:!P||P.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(A,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Nenhuma vacina cadastrada na biblioteca"})]}):e.jsxs(ee,{children:[e.jsx(ae,{children:e.jsxs(V,{children:[e.jsx(i,{children:"Nome"}),e.jsx(i,{children:"Descrição"}),e.jsx(i,{children:"Intervalo (dias)"}),e.jsx(i,{children:"Comum"})]})}),e.jsx(se,{children:P.map(a=>e.jsxs(V,{children:[e.jsx(n,{className:"font-medium",children:a.name}),e.jsx(n,{className:"max-w-xs truncate text-sm text-muted-foreground",children:a.description||"-"}),e.jsx(n,{className:"text-sm text-muted-foreground",children:a.recommendedIntervalDays||"-"}),e.jsx(n,{children:a.isCommon?e.jsx(v,{variant:"default",children:"Comum"}):e.jsx(v,{variant:"outline",children:"Personalizada"})})]},a.id))})]})})]})}),e.jsxs(X,{value:"applications",className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs(h,{children:[e.jsx(j,{className:"pb-3",children:e.jsx(p,{className:"text-sm font-medium text-muted-foreground",children:"Total de Aplicações"})}),e.jsx(g,{children:e.jsx("div",{className:"text-2xl font-bold",children:T.total})})]}),e.jsxs(h,{children:[e.jsx(j,{className:"pb-3",children:e.jsx(p,{className:"text-sm font-medium text-muted-foreground",children:"Atrasadas"})}),e.jsx(g,{children:e.jsx("div",{className:"text-2xl font-bold text-red-600",children:T.overdue})})]}),e.jsxs(h,{children:[e.jsx(j,{className:"pb-3",children:e.jsx(p,{className:"text-sm font-medium text-muted-foreground",children:"Próximas (30 dias)"})}),e.jsx(g,{children:e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:T.upcoming})})]}),e.jsxs(h,{children:[e.jsx(j,{className:"pb-3",children:e.jsx(p,{className:"text-sm font-medium text-muted-foreground",children:"Em Dia"})}),e.jsx(g,{children:e.jsx("div",{className:"text-2xl font-bold text-green-600",children:T.uptodate})})]})]}),e.jsxs(h,{children:[e.jsxs(j,{children:[e.jsx(p,{children:"Aplicações de Vacinas"}),e.jsx(H,{children:"Todas as vacinas aplicadas nos pets"})]}),e.jsxs(g,{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsx("div",{className:"flex-1 min-w-[200px]",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ve,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(D,{placeholder:"Buscar por vacina ou pet...",value:E,onChange:a=>le(a.target.value),className:"pl-10"})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(r,{variant:l==="all"?"default":"outline",size:"sm",onClick:()=>b("all"),children:"Todas"}),e.jsx(r,{variant:l==="overdue"?"destructive":"outline",size:"sm",onClick:()=>b("overdue"),children:"Atrasadas"}),e.jsx(r,{variant:l==="upcoming"?"default":"outline",size:"sm",onClick:()=>b("upcoming"),className:l==="upcoming"?"bg-orange-500 hover:bg-orange-600":"",children:"Próximas"}),e.jsx(r,{variant:l==="uptodate"?"default":"outline",size:"sm",onClick:()=>b("uptodate"),className:l==="uptodate"?"bg-green-600 hover:bg-green-700":"",children:"Em Dia"})]}),e.jsxs(Y,{value:N,onValueChange:ce,children:[e.jsxs(Z,{className:"w-[180px]",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),e.jsx(_,{})]}),e.jsxs($,{children:[e.jsx(f,{value:"all",children:"Todos os Períodos"}),e.jsx(f,{value:"7days",children:"Últimos 7 dias"}),e.jsx(f,{value:"30days",children:"Últimos 30 dias"}),e.jsx(f,{value:"90days",children:"Últimos 90 dias"})]})]}),e.jsxs(Y,{value:I,onValueChange:oe,children:[e.jsxs(Z,{className:"w-[180px]",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),e.jsx(_,{})]}),e.jsxs($,{children:[e.jsx(f,{value:"all",children:"Todos os Pets"}),O?.map(a=>e.jsx(f,{value:a.id.toString(),children:a.name},a.id))]})]})]}),k.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(A,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Nenhuma aplicação encontrada"})]}):e.jsxs(ee,{children:[e.jsx(ae,{children:e.jsxs(V,{children:[e.jsx(i,{children:"Pet"}),e.jsx(i,{children:"Vacina"}),e.jsx(i,{children:"Dose"}),e.jsx(i,{children:"Aplicação"}),e.jsx(i,{children:"Próxima Dose"}),e.jsx(i,{children:"Veterinário"}),e.jsx(i,{children:"Status"}),e.jsx(i,{className:"text-right",children:"Ações"})]})}),e.jsx(se,{children:k.map(a=>{const s=xe?.find(t=>t.resourceType==="vaccine"&&t.resourceId===a.id);return e.jsxs(V,{children:[e.jsx(n,{className:"font-medium",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[a.petName,s?e.jsx(Te,{changes:[s],resourceType:"vaccine"}):null]})}),e.jsx(n,{children:a.vaccine?.name||"-"}),e.jsx(n,{className:"text-sm text-muted-foreground",children:a.doseNumber||"-"}),e.jsx(n,{children:new Date(a.applicationDate).toLocaleDateString("pt-BR")}),e.jsx(n,{children:a.nextDueDate?e.jsxs("div",{className:"flex items-center gap-2",children:[new Date(a.nextDueDate).toLocaleDateString("pt-BR"),new Date(a.nextDueDate)<new Date&&e.jsx(Ne,{className:"h-4 w-4 text-red-500"})]}):"-"}),e.jsx(n,{className:"text-sm text-muted-foreground",children:a.veterinarian||"-"}),e.jsx(n,{children:fe(a.nextDueDate)}),e.jsx(n,{className:"text-right",children:e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(r,{size:"sm",variant:"outline",onClick:()=>{z(a),w(!0)},children:e.jsx(Ae,{className:"h-4 w-4"})}),e.jsx(r,{size:"sm",variant:"destructive",onClick:()=>ge(a.id,a.petId),children:e.jsx(Fe,{className:"h-4 w-4"})})]})})]},a.id)})})]})]})]})]})]}),e.jsx(q,{open:de,onOpenChange:w,children:e.jsx(M,{children:e.jsxs("form",{onSubmit:De,children:[e.jsxs(Q,{children:[e.jsx(U,{children:"Editar Vacinação"}),e.jsx(G,{children:"Atualize as informações da vacinação"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"nextDueDate",children:"Próxima Dose"}),e.jsx(D,{id:"nextDueDate",name:"nextDueDate",type:"date",defaultValue:o?.nextDueDate?new Date(o.nextDueDate).toISOString().split("T")[0]:""})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"veterinarian",children:"Veterinário"}),e.jsx(D,{id:"veterinarian",name:"veterinarian",placeholder:"Nome do veterinário",defaultValue:o?.veterinarian||""})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"clinic",children:"Clínica"}),e.jsx(D,{id:"clinic",name:"clinic",placeholder:"Nome da clínica",defaultValue:o?.clinic||""})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"notes",children:"Observações"}),e.jsx(K,{id:"notes",name:"notes",placeholder:"Observações sobre a vacinação...",rows:3,defaultValue:o?.notes||""})]})]}),e.jsxs(J,{children:[e.jsx(r,{type:"button",variant:"outline",onClick:()=>w(!1),children:"Cancelar"}),e.jsx(r,{type:"submit",children:"Salvar"})]})]})})})]})})}export{aa as default};
