import{r as f,t as h,a as g,j as e,C as a,f as t,B as u,b as d,d as n,i as D,o as R,p as V,q,s as B,v as U,h as N,I as P,w as $}from"./index-DG0yx2hi.js";import{A as b}from"./AdminLayout-CapzJ-JK.js";import{S as G,a as H,b as M,c as W,d as z}from"./select-k5kl2mY3.js";import{S as J}from"./SearchAndFilter-CyeyrFac.js";import{P as A}from"./plus-DIKUpKHa.js";import{C as E}from"./credit-card-CxD7Buqp.js";import{T as K}from"./trending-up-C2VanZIM.js";import{D as X}from"./layout-dashboard-CC4g-mOh.js";import"./popover-Bqiz4euq.js";import"./scroll-area-C0S6gB82.js";import"./index-BdQq_4o_.js";import"./wallet-CKmMh37E.js";import"./users-DD1qYPM2.js";import"./user-B4BzRHVK.js";import"./index-r4-iOF84.js";import"./chevron-down-CKVtRMqG.js";import"./check-DDByOptX.js";import"./search-DtaYG9vz.js";import"./filter-C966fxzX.js";function je(){const[y,v]=f.useState(""),[F,i]=f.useState(!1),[p,c]=f.useState(null),{data:l,isLoading:L,error:o}=h.pets.list.useQuery(),{data:C,isLoading:k,error:m}=h.credits.getStats.useQuery(),S=h.useUtils();(o||m)&&console.error("Error loading credits page:",o||m);const j=h.credits.addPackage.useMutation({onSuccess:()=>{g.success("Créditos adicionados com sucesso!"),i(!1),c(null),S.pets.list.invalidate(),S.credits.getStats.invalidate()},onError:s=>{g.error("Erro ao adicionar créditos: "+s.message)}}),T=s=>{if(s.preventDefault(),!p){g.error("Selecione um pet");return}const r=new FormData(s.currentTarget),x=Number(r.get("days")),Q=Number(r.get("price"));j.mutate({petId:p,packageDays:x,packagePrice:Q})},w=l?.filter(s=>s.name.toLowerCase().includes(y.toLowerCase()))||[],I=l?.reduce((s,r)=>s+(r.credits||0),0)||0,O=l?.filter(s=>(s.credits||0)<5).length||0;return o||m?e.jsx(b,{children:e.jsx("div",{className:"container py-8",children:e.jsx(a,{className:"border-red-200 bg-red-50/50",children:e.jsx(t,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-red-600 font-medium mb-2",children:"Erro ao carregar créditos"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:(o||m)?.message})]})})})})}):L||k?e.jsx(b,{children:e.jsx("div",{className:"container py-8 flex justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Carregando..."})]})})}):e.jsx(b,{children:e.jsxs("div",{className:"space-y-8 animate-fade-in",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Gestão de Diárias"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Gerencie créditos de diárias dos pets e controle financeiro"})]}),e.jsxs(u,{onClick:()=>i(!0),className:"gradient-primary",children:[e.jsx(A,{className:"mr-2 h-4 w-4"}),"Adicionar Diárias"]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs(a,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"Total de Diárias"}),e.jsx(E,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(t,{children:[e.jsx("div",{className:"text-2xl font-bold",children:I}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Saldo total de todos os pets"})]})]}),e.jsxs(a,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"Saldo Baixo"}),e.jsx(D,{className:"h-4 w-4 text-orange-500"})]}),e.jsxs(t,{children:[e.jsx("div",{className:"text-2xl font-bold",children:O}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Pets com menos de 5 diárias"})]})]}),e.jsxs(a,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"Receita Mensal"}),e.jsx(K,{className:"h-4 w-4 text-green-500"})]}),e.jsxs(t,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["R$ ",((C?.monthlyRevenue||0)/100).toFixed(2)]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Vendas de pacotes este mês"})]})]}),e.jsxs(a,{children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(n,{className:"text-sm font-medium",children:"Pets com Créditos"}),e.jsx(X,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(t,{children:[e.jsx("div",{className:"text-2xl font-bold",children:C?.petsWithCredits||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Pets com saldo ativo"})]})]})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Saldo de Diárias por Pet"}),e.jsx(a,{children:e.jsxs(t,{className:"pt-6 space-y-4",children:[e.jsx(J,{searchPlaceholder:"Buscar pet...",searchValue:y,onSearchChange:v,onClearFilters:()=>v("")}),e.jsxs("div",{className:"space-y-2",children:[w.map(s=>{const r=s.credits||0,x=r<5;return e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg border hover:bg-accent transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[s.photoUrl?e.jsx("img",{src:s.photoUrl,alt:s.name,className:"w-10 h-10 rounded-full object-cover"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-primary flex items-center justify-center text-white font-semibold",children:s.name[0]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.breed||"Sem raça definida"})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:`text-lg font-bold ${x?"text-orange-500":"text-primary"}`,children:[r," ",r===1?"diária":"diárias"]}),x&&e.jsxs("p",{className:"text-xs text-orange-500 flex items-center gap-1",children:[e.jsx(D,{className:"h-3 w-3"}),"Saldo baixo"]})]}),e.jsxs(u,{size:"sm",variant:"outline",onClick:()=>{c(s.id),i(!0)},children:[e.jsx(A,{className:"h-4 w-4 mr-1"}),"Adicionar"]})]})]},s.id)}),w.length===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Nenhum pet encontrado"})]})]})})]}),e.jsxs(a,{className:"bg-blue-50 border-blue-200",children:[e.jsx(d,{children:e.jsxs(n,{className:"text-blue-900 flex items-center gap-2",children:[e.jsx(E,{className:"h-5 w-5"}),"Como Funciona o Sistema de Diárias"]})}),e.jsxs(t,{className:"text-blue-800 space-y-2",children:[e.jsx("p",{children:"• Cada diária representa um dia de creche para o pet"}),e.jsx("p",{children:"• O saldo é consumido automaticamente no check-in"}),e.jsx("p",{children:"• Tutores podem comprar pacotes de diárias com desconto"}),e.jsx("p",{children:"• Configure alertas quando o saldo estiver baixo (menos de 5 diárias)"}),e.jsx("p",{children:"• Acompanhe o consumo e receitas na página de Finanças"})]})]}),e.jsx(R,{open:F,onOpenChange:i,children:e.jsxs(V,{children:[e.jsxs(q,{children:[e.jsx(B,{children:"Adicionar Diárias"}),e.jsx(U,{children:"Adicione um pacote de diárias ao pet selecionado"})]}),e.jsxs("form",{onSubmit:T,children:[e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"pet",children:"Pet"}),e.jsxs(G,{value:p?.toString()||"",onValueChange:s=>c(Number(s)),children:[e.jsx(H,{children:e.jsx(M,{placeholder:"Selecione um pet"})}),e.jsx(W,{children:l?.map(s=>e.jsxs(z,{value:s.id.toString(),children:[s.name," - ",s.credits||0," ",s.credits===1?"diária":"diárias"]},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"days",children:"Quantidade de Diárias"}),e.jsx(P,{id:"days",name:"days",type:"number",min:"1",required:!0,placeholder:"Ex: 10"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"price",children:"Valor Total (R$)"}),e.jsx(P,{id:"price",name:"price",type:"number",step:"0.01",min:"0",required:!0,placeholder:"Ex: 500.00"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"O valor será registrado nas finanças como receita"})]})]}),e.jsxs($,{children:[e.jsx(u,{type:"button",variant:"outline",onClick:()=>{i(!1),c(null)},children:"Cancelar"}),e.jsx(u,{type:"submit",disabled:j.isPending,children:j.isPending?"Adicionando...":"Adicionar Diárias"})]})]})]})})]})})}export{je as default};
