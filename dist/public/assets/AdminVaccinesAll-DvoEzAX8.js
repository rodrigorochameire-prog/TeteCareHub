import{r as j,u as q,t as p,a as T,j as e,B as v,C as c,f as l,i as A,c as U,I as g,b as X,d as G,e as J,o as K,p as W,q as Y,s as Z,v as _,h as f,w as $,X as ee}from"./index-DG0yx2hi.js";import{A as ae}from"./AdminLayout-CapzJ-JK.js";import{S as C,B as D}from"./popover-Bqiz4euq.js";import{S as se,a as te,b as ne,c as ie,d as N}from"./select-k5kl2mY3.js";import{T as re,a as ce,b as E,c as i,d as le,e as r}from"./table-DeOYaLOA.js";import{R as oe}from"./RecentChangeIndicator-dH2jnUR2.js";import{T as de}from"./textarea-BfRN5q_Y.js";import{A as xe}from"./arrow-left-B-xkxJNp.js";import{S as me}from"./search-DtaYG9vz.js";import{S as he}from"./square-pen-D7F5zf6L.js";import{S as ue}from"./save-Cc15p_sb.js";import"./scroll-area-C0S6gB82.js";import"./index-BdQq_4o_.js";import"./layout-dashboard-CC4g-mOh.js";import"./wallet-CKmMh37E.js";import"./users-DD1qYPM2.js";import"./user-B4BzRHVK.js";import"./index-r4-iOF84.js";import"./chevron-down-CKVtRMqG.js";import"./check-DDByOptX.js";import"./clock-BQzFMz2h.js";function Re(){const[b,L]=j.useState(""),[o,P]=j.useState("all"),[t,y]=j.useState(null),[I,h]=j.useState(!1),[,B]=q(),{data:k,refetch:F}=p.pets.list.useQuery(),{data:V}=p.changeHistory.getRecentChanges.useQuery({limit:200}),w=p.vaccines.update.useMutation({onSuccess:()=>{T.success("Vacinação atualizada com sucesso!"),h(!1),y(null),F()},onError:a=>{T.error("Erro ao atualizar vacinação: "+a.message)}}),R=a=>{y(a),h(!0)},O=a=>{a.preventDefault();const s=new FormData(a.currentTarget),n=s.get("nextDueDate"),z=s.get("veterinarian"),M=s.get("clinic"),Q=s.get("notes");w.mutate({id:t.vaccination.id,petId:t.petId,nextDueDate:n?new Date(n):void 0,veterinarian:z||void 0,clinic:M||void 0,notes:Q||void 0})},d=(k?.map(a=>{const{data:s}=p.vaccines.getPetVaccinations.useQuery({petId:a.id});return{pet:a,vaccinations:s||[]}}).filter(Boolean)||[]).flatMap(({pet:a,vaccinations:s})=>s.map(n=>({...n,petName:a.name,petId:a.id}))),x=a=>a?new Date(a)<new Date:!1,m=a=>{if(!a)return!1;const s=Math.ceil((new Date(a).getTime()-new Date().getTime())/(1e3*60*60*24));return s>0&&s<=30},S=d.filter(a=>{const s=a.petName.toLowerCase().includes(b.toLowerCase())||a.vaccine.name.toLowerCase().includes(b.toLowerCase()),n=o==="all"||o==="overdue"&&x(a.vaccination.nextDueDate)||o==="upcoming"&&m(a.vaccination.nextDueDate)||o==="ok"&&!x(a.vaccination.nextDueDate)&&!m(a.vaccination.nextDueDate);return s&&n}),H=a=>V?V.filter(s=>s.resourceType==="preventive"&&s.resourceId===a).slice(0,3):[],u={total:d.length,overdue:d.filter(a=>x(a.vaccination.nextDueDate)).length,upcoming:d.filter(a=>m(a.vaccination.nextDueDate)).length,ok:d.filter(a=>!x(a.vaccination.nextDueDate)&&!m(a.vaccination.nextDueDate)).length};return e.jsxs(ae,{children:[e.jsxs("div",{className:"container mx-auto py-8",children:[e.jsxs("div",{className:"mb-8 flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold mb-2",children:"Vacinas - Todos os Pets"}),e.jsx("p",{className:"text-muted-foreground",children:"Visualize e gerencie vacinas de todos os pets cadastrados"})]}),e.jsxs(v,{variant:"outline",onClick:()=>B("/admin/vaccines"),children:[e.jsx(xe,{className:"mr-2 h-4 w-4"}),"Voltar para Biblioteca"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(c,{children:e.jsx(l,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total"}),e.jsx("p",{className:"text-3xl font-bold",children:u.total})]}),e.jsx(C,{className:"h-10 w-10 text-primary"})]})})}),e.jsx(c,{children:e.jsx(l,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Atrasadas"}),e.jsx("p",{className:"text-3xl font-bold text-red-600",children:u.overdue})]}),e.jsx(A,{className:"h-10 w-10 text-red-600"})]})})}),e.jsx(c,{children:e.jsx(l,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Próximas (30d)"}),e.jsx("p",{className:"text-3xl font-bold text-orange-600",children:u.upcoming})]}),e.jsx(A,{className:"h-10 w-10 text-orange-600"})]})})}),e.jsx(c,{children:e.jsx(l,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Em Dia"}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:u.ok})]}),e.jsx(U,{className:"h-10 w-10 text-green-600"})]})})})]}),e.jsx(c,{className:"mb-6",children:e.jsx(l,{className:"pt-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(me,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(g,{placeholder:"Buscar por pet ou vacina...",value:b,onChange:a=>L(a.target.value),className:"pl-10"})]}),e.jsxs(se,{value:o,onValueChange:P,children:[e.jsx(te,{children:e.jsx(ne,{placeholder:"Status"})}),e.jsxs(ie,{children:[e.jsx(N,{value:"all",children:"Todos os status"}),e.jsx(N,{value:"overdue",children:"Atrasadas"}),e.jsx(N,{value:"upcoming",children:"Próximas (30 dias)"}),e.jsx(N,{value:"ok",children:"Em dia"})]})]})]})})}),e.jsxs(c,{children:[e.jsxs(X,{children:[e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(C,{className:"h-5 w-5"}),"Vacinas (",S.length,")"]}),e.jsx(J,{children:"Lista completa de vacinas de todos os pets"})]}),e.jsx(l,{children:S.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(C,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-lg font-medium",children:"Nenhuma vacina encontrada"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ajuste os filtros ou adicione vacinas aos pets"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(re,{children:[e.jsx(ce,{children:e.jsxs(E,{children:[e.jsx(i,{children:"Pet"}),e.jsx(i,{children:"Vacina"}),e.jsx(i,{children:"Dose"}),e.jsx(i,{children:"Aplicação"}),e.jsx(i,{children:"Próxima Dose"}),e.jsx(i,{children:"Veterinário"}),e.jsx(i,{children:"Status"}),e.jsx(i,{children:"Alterações"}),e.jsx(i,{children:"Ações"})]})}),e.jsx(le,{children:S.map(a=>{const s=x(a.vaccination.nextDueDate),n=m(a.vaccination.nextDueDate);return e.jsxs(E,{children:[e.jsx(r,{className:"font-medium",children:a.petName}),e.jsx(r,{children:a.vaccine.name}),e.jsx(r,{children:e.jsxs(D,{variant:"outline",children:["Dose ",a.vaccination.doseNumber||1]})}),e.jsx(r,{children:new Date(a.vaccination.applicationDate).toLocaleDateString("pt-BR")}),e.jsx(r,{children:a.vaccination.nextDueDate?new Date(a.vaccination.nextDueDate).toLocaleDateString("pt-BR"):"-"}),e.jsx(r,{children:a.vaccination.veterinarian||"-"}),e.jsxs(r,{children:[s&&e.jsx(D,{variant:"destructive",children:"Atrasada"}),n&&!s&&e.jsx(D,{className:"bg-orange-100 text-orange-700 border-orange-200",children:"Próxima"}),!s&&!n&&e.jsx(D,{variant:"default",className:"bg-green-100 text-green-700 border-green-200",children:"Em dia"})]}),e.jsx(r,{children:e.jsx(oe,{changes:H(a.vaccination.id),resourceType:"vaccine"})}),e.jsx(r,{children:e.jsx(v,{size:"sm",variant:"ghost",onClick:()=>R(a),children:e.jsx(he,{className:"h-4 w-4"})})})]},a.vaccination.id)})})]})})})]})]}),e.jsx(K,{open:I,onOpenChange:h,children:e.jsxs(W,{className:"max-w-md",children:[e.jsxs(Y,{children:[e.jsx(Z,{children:"Editar Vacinação"}),e.jsx(_,{children:t&&e.jsxs("span",{children:[t.vaccine.name," - ",t.petName]})})]}),t&&e.jsxs("form",{onSubmit:O,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"nextDueDate",children:"Próxima Dose"}),e.jsx(g,{id:"nextDueDate",name:"nextDueDate",type:"date",defaultValue:t.vaccination.nextDueDate?new Date(t.vaccination.nextDueDate).toISOString().split("T")[0]:""})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"veterinarian",children:"Veterinário"}),e.jsx(g,{id:"veterinarian",name:"veterinarian",type:"text",defaultValue:t.vaccination.veterinarian||"",placeholder:"Nome do veterinário"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"clinic",children:"Clínica"}),e.jsx(g,{id:"clinic",name:"clinic",type:"text",defaultValue:t.vaccination.clinic||"",placeholder:"Nome da clínica"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"notes",children:"Observações"}),e.jsx(de,{id:"notes",name:"notes",rows:3,defaultValue:t.vaccination.notes||"",placeholder:"Adicione observações sobre a vacinação..."})]})]}),e.jsxs($,{className:"mt-6",children:[e.jsxs(v,{type:"button",variant:"outline",onClick:()=>h(!1),children:[e.jsx(ee,{className:"mr-2 h-4 w-4"}),"Cancelar"]}),e.jsxs(v,{type:"submit",disabled:w.isPending,children:[e.jsx(ue,{className:"mr-2 h-4 w-4"}),w.isPending?"Salvando...":"Salvar"]})]})]})]})})]})}export{Re as default};
