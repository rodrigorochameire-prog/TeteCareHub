import{t as i,r as o,a as n,j as e,C,B as t,X as ae,D as q,I as Q,K as te,o as re,p as le,q as ie,s as ne}from"./index-DG0yx2hi.js";import{T as ce}from"./textarea-BfRN5q_Y.js";import{A as P,B as S,M as oe}from"./popover-Bqiz4euq.js";import{S as T,a as U,b as k,c as A,d as x}from"./select-k5kl2mY3.js";import{U as D}from"./users-DD1qYPM2.js";import{U as $}from"./user-B4BzRHVK.js";import{I as de}from"./image-BoirZu0B.js";import{S as K}from"./send-BU_qFC5s.js";import{T as me}from"./trash-2-6I2MbiK3.js";function we({petId:z}){const{data:d}=i.auth.me.useQuery(),u=i.useUtils(),[v,M]=o.useState(""),[c,N]=o.useState([]),[r,h]=o.useState(null),[f,R]=o.useState(""),[g,E]=o.useState("general"),[w,j]=o.useState(),[m,p]=o.useState("all"),{data:F}=i.tutors.list.useQuery({page:1,limit:100}),{data:I}=i.pets.list.useQuery(),{data:b,isLoading:O}=i.wall.getPosts.useQuery({petId:z,limit:20,targetType:m==="all"?void 0:m}),B=i.wall.createPost.useMutation({onSuccess:()=>{u.wall.getPosts.invalidate(),M(""),N([]),n.success("Post publicado com sucesso!")},onError:s=>{n.error(`Erro ao publicar: ${s.message}`)}}),L=i.wall.addComment.useMutation({onSuccess:()=>{u.wall.getPosts.invalidate(),R(""),n.success("ComentÃ¡rio adicionado!")}}),W=i.wall.addReaction.useMutation({onSuccess:()=>{u.wall.getPosts.invalidate()}}),G=i.wall.deletePost.useMutation({onSuccess:()=>{u.wall.getPosts.invalidate(),h(null),n.success("Post excluÃ­do!")}}),H=s=>{const a=Array.from(s.target.files||[]);if(a.length+c.length>10){n.error("MÃ¡ximo de 10 fotos por post");return}N([...c,...a])},X=s=>{N(c.filter((a,l)=>l!==s))},_=async()=>{if(!v.trim()&&c.length===0){n.error("Adicione texto ou fotos ao post");return}try{const s=[];for(const a of c){if(!a.type.startsWith("image/")){n.error(`Arquivo ${a.name} nÃ£o Ã© uma imagem vÃ¡lida`);return}if(a.size>10*1024*1024){n.error(`Arquivo ${a.name} Ã© muito grande (mÃ¡x. 10MB)`);return}const l=new FileReader,Z=await new Promise((ee,se)=>{l.onloadend=()=>ee(l.result),l.onerror=()=>se(new Error("Erro ao ler arquivo")),l.readAsDataURL(a)});s.push(Z)}await B.mutateAsync({petId:z,content:v||void 0,mediaData:s.length>0?s:void 0,postType:s.length>0?"photo":"text",targetType:g,targetId:w}),E("general"),j(void 0)}catch(s){n.error("Erro ao processar as imagens"),console.error("Upload error:",s)}},V=s=>{f.trim()&&L.mutate({postId:s,comment:f})},y=(s,a)=>{W.mutate({postId:s,reactionType:a})},J=s=>{confirm("Tem certeza que deseja excluir este post?")&&G.mutate({postId:s})},Y={like:"â¤ï¸",love:"ðŸ¾",laugh:"ðŸ˜‚",wow:"ðŸ˜®",sad:"ðŸ˜¢"};return O?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500"})}):e.jsxs("div",{className:"space-y-6",children:[d&&e.jsx(C,{className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(ce,{placeholder:"Compartilhe algo sobre o dia na creche...",value:v,onChange:s=>M(s.target.value),className:"min-h-[100px]"}),c.length>0&&e.jsx("div",{className:"grid grid-cols-4 gap-2",children:c.map((s,a)=>e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:URL.createObjectURL(s),alt:"Preview",className:"w-full h-24 object-cover rounded"}),e.jsx(t,{variant:"destructive",size:"sm",className:"absolute top-1 right-1 h-6 w-6 p-0",onClick:()=>X(a),children:e.jsx(ae,{className:"h-4 w-4"})})]},a))}),d?.role==="admin"&&e.jsxs("div",{className:"flex gap-2 items-center p-3 bg-muted/50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium",children:"DestinatÃ¡rio:"}),e.jsxs(T,{value:g,onValueChange:s=>{E(s),j(void 0)},children:[e.jsx(U,{className:"w-[180px]",children:e.jsx(k,{})}),e.jsxs(A,{children:[e.jsx(x,{value:"general",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-4 w-4"}),"Geral (Todos)"]})}),e.jsx(x,{value:"tutor",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-4 w-4"}),"Tutor EspecÃ­fico"]})}),e.jsx(x,{value:"pet",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-4 w-4"}),"Pet EspecÃ­fico"]})})]})]}),g==="tutor"&&F&&e.jsxs(T,{value:w?.toString(),onValueChange:s=>j(parseInt(s)),children:[e.jsx(U,{className:"w-[200px]",children:e.jsx(k,{placeholder:"Selecione o tutor"})}),e.jsx(A,{children:F.tutors?.map(s=>e.jsx(x,{value:s.id.toString(),children:s.name},s.id))})]}),g==="pet"&&I&&e.jsxs(T,{value:w?.toString(),onValueChange:s=>j(parseInt(s)),children:[e.jsx(U,{className:"w-[200px]",children:e.jsx(k,{placeholder:"Selecione o pet"})}),e.jsx(A,{children:I.map(s=>e.jsx(x,{value:s.id.toString(),children:s.name},s.id))})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx(Q,{type:"file",accept:"image/*,video/*",multiple:!0,className:"hidden",id:"post-media",onChange:H}),e.jsxs(t,{variant:"outline",size:"sm",type:"button",onClick:()=>document.getElementById("post-media")?.click(),children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"Adicionar Fotos/VÃ­deos"]})]}),e.jsxs(t,{onClick:_,disabled:B.isPending,children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"Publicar"]})]})]})}),e.jsxs("div",{className:"flex gap-2 items-center p-4 bg-card rounded-lg border",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Filtrar:"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(t,{variant:m==="all"?"default":"outline",size:"sm",onClick:()=>p("all"),children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),"Todos"]}),e.jsxs(t,{variant:m==="general"?"default":"outline",size:"sm",onClick:()=>p("general"),children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),"Gerais"]}),d?.role==="admin"&&e.jsxs(e.Fragment,{children:[e.jsxs(t,{variant:m==="tutor"?"default":"outline",size:"sm",onClick:()=>p("tutor"),children:[e.jsx($,{className:"h-4 w-4 mr-2"}),"Privados (Tutor)"]}),e.jsxs(t,{variant:m==="pet"?"default":"outline",size:"sm",onClick:()=>p("pet"),children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"Privados (Pet)"]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[b&&b.length===0&&e.jsx(C,{className:"p-12 text-center",children:e.jsx("p",{className:"text-muted-foreground",children:"Nenhum post ainda. Seja o primeiro a compartilhar!"})}),b?.map(s=>e.jsxs(C,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(P,{className:"h-10 w-10 bg-orange-100 flex items-center justify-center",children:e.jsx("span",{className:"text-orange-600 font-semibold",children:s.authorName?.charAt(0)||"U"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:s.authorName||"UsuÃ¡rio"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx("span",{children:new Date(s.createdAt).toLocaleDateString("pt-BR")}),s.petName&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"â€¢"}),e.jsx(S,{variant:"secondary",children:s.petName})]}),s.targetType!=="general"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"â€¢"}),e.jsx(S,{variant:"outline",className:"bg-blue-50 text-blue-700 border-blue-200",children:s.targetType==="tutor"?"Privado (Tutor)":"Privado (Pet)"})]}),s.authorRole==="admin"&&e.jsx(S,{variant:"default",className:"bg-orange-500",children:"Creche"})]})]})]}),(d?.role==="admin"||d?.id===s.authorId)&&e.jsx(t,{variant:"ghost",size:"sm",onClick:()=>J(s.id),className:"text-red-500 hover:text-red-700",children:e.jsx(me,{className:"h-4 w-4"})})]}),s.content&&e.jsx("p",{className:"mb-4 whitespace-pre-wrap",children:s.content}),s.mediaUrls&&s.mediaUrls.length>0&&e.jsxs("div",{className:`grid gap-2 mb-4 ${s.mediaUrls.length===1?"grid-cols-1":s.mediaUrls.length===2?"grid-cols-2":s.mediaUrls.length===3?"grid-cols-3":"grid-cols-2 md:grid-cols-3"}`,children:[s.mediaUrls.slice(0,6).map((a,l)=>e.jsx("img",{src:a,alt:"Post media",className:"w-full h-48 object-cover rounded cursor-pointer hover:opacity-90 transition",onClick:()=>h(s)},l)),s.mediaUrls.length>6&&e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:s.mediaUrls[5],alt:"More",className:"w-full h-48 object-cover rounded opacity-50"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("span",{className:"text-2xl font-bold text-white",children:["+",s.mediaUrls.length-6]})})]})]}),e.jsxs("div",{className:"flex items-center gap-4 py-3 border-y",children:[e.jsx("div",{className:"flex items-center gap-1",children:Object.entries(s.reactionCounts||{}).map(([a,l])=>e.jsxs("span",{className:"text-sm",children:[Y[a]," ",l]},a))}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[s.commentCount," comentÃ¡rios"]})]}),e.jsxs("div",{className:"flex items-center gap-2 pt-3",children:[e.jsxs(t,{variant:"ghost",size:"sm",onClick:()=>y(s.id,"like"),className:"hover:bg-red-50 hover:text-red-500 transition-colors",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Curtir"]}),e.jsxs(t,{variant:"ghost",size:"sm",onClick:()=>h(s),className:"hover:bg-blue-50 hover:text-blue-500 transition-colors",children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),"Comentar"]}),e.jsx(t,{variant:"ghost",size:"sm",onClick:()=>y(s.id,"laugh"),className:"hover:bg-yellow-50 transition-colors",children:"ðŸ˜‚ Rir"}),e.jsx(t,{variant:"ghost",size:"sm",onClick:()=>y(s.id,"sad"),className:"hover:bg-gray-50 transition-colors",children:"ðŸ˜¢ Triste"})]}),s.comments&&s.comments.length>0&&e.jsxs("div",{className:"mt-4 space-y-3 pt-3 border-t",children:[s.comments.slice(0,2).map(a=>e.jsxs("div",{className:"flex gap-3",children:[e.jsx(P,{className:"h-8 w-8 bg-gray-100 flex items-center justify-center",children:e.jsx("span",{className:"text-gray-600 text-sm",children:a.authorName?.charAt(0)||"U"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"bg-gray-100 rounded-lg p-3",children:[e.jsx("p",{className:"font-semibold text-sm",children:a.authorName}),e.jsx("p",{className:"text-sm",children:a.comment})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:new Date(a.createdAt).toLocaleString("pt-BR")})]})]},a.id)),s.comments.length>2&&e.jsxs(t,{variant:"link",size:"sm",onClick:()=>h(s),className:"text-orange-500",children:["Ver todos os ",s.comments.length," comentÃ¡rios"]})]})]},s.id))]}),r&&e.jsx(re,{open:!!r,onOpenChange:()=>h(null),children:e.jsxs(le,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(ie,{children:e.jsxs(ne,{children:["Post de ",r.authorName]})}),e.jsxs("div",{className:"space-y-4",children:[r.content&&e.jsx("p",{className:"whitespace-pre-wrap",children:r.content}),r.mediaUrls&&r.mediaUrls.length>0&&e.jsx("div",{className:"grid grid-cols-2 gap-2",children:r.mediaUrls.map((s,a)=>e.jsx("img",{src:s,alt:"Media",className:"w-full rounded"},a))}),e.jsxs("div",{className:"space-y-3 pt-4 border-t",children:[e.jsx("h3",{className:"font-semibold",children:"ComentÃ¡rios"}),r.comments?.map(s=>e.jsxs("div",{className:"flex gap-3",children:[e.jsx(P,{className:"h-8 w-8 bg-gray-100 flex items-center justify-center",children:e.jsx("span",{className:"text-gray-600 text-sm",children:s.authorName?.charAt(0)||"U"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"bg-gray-100 rounded-lg p-3",children:[e.jsx("p",{className:"font-semibold text-sm",children:s.authorName}),e.jsx("p",{className:"text-sm",children:s.comment})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:new Date(s.createdAt).toLocaleString("pt-BR")})]})]},s.id)),d&&e.jsxs("div",{className:"flex gap-2 pt-3",children:[e.jsx(Q,{placeholder:"Escreva um comentÃ¡rio...",value:f,onChange:s=>R(s.target.value),onKeyPress:s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),V(r.id))}}),e.jsx(t,{onClick:()=>V(r.id),disabled:L.isPending,children:e.jsx(K,{className:"h-4 w-4"})})]})]})]})]})})]})}export{we as W};
