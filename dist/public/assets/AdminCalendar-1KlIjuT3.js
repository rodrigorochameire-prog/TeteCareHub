import{r as j,t as p,a as d,j as e,C as D,b as N,d as y,f as w,i as oe,c as de,B as c,n as I,X as O,D as R,o as ce,p as me,q as xe,s as he,v as ue,h as m,I as C}from"./index-DG0yx2hi.js";import{A as pe}from"./AdminLayout-CapzJ-JK.js";import{P as ge}from"./PremiumCalendar-D3WnfHEC.js";import{B as Y}from"./popover-Bqiz4euq.js";import{T as ve}from"./textarea-BfRN5q_Y.js";import{S as V,a as z,b as H,c as $,d as i}from"./select-k5kl2mY3.js";import{C as je}from"./checkbox-ZWSIQfST.js";import{T as fe}from"./trending-up-C2VanZIM.js";import{D as be}from"./download-DIpAs7NP.js";import{C as q}from"./clock-BQzFMz2h.js";import{M as G}from"./map-pin-Ddjw85I1.js";import{S as U}from"./square-pen-D7F5zf6L.js";import{T as De}from"./trash-2-6I2MbiK3.js";import{S as Ne}from"./save-Cc15p_sb.js";import"./scroll-area-C0S6gB82.js";import"./index-BdQq_4o_.js";import"./layout-dashboard-CC4g-mOh.js";import"./wallet-CKmMh37E.js";import"./users-DD1qYPM2.js";import"./user-B4BzRHVK.js";import"./chevron-left-DzbQ4jE-.js";import"./chevron-right-DecBlSPI.js";import"./search-DtaYG9vz.js";import"./filter-C966fxzX.js";import"./log-in-USQiO92O.js";import"./plus-DIKUpKHa.js";import"./index-r4-iOF84.js";import"./chevron-down-CKVtRMqG.js";import"./check-DDByOptX.js";function Ze(){const[a,f]=j.useState(null),[Q,h]=j.useState(!1),[b,g]=j.useState(!1),[s,r]=j.useState({}),[u,F]=j.useState(null),l=new Date,X=new Date(l.getFullYear(),l.getMonth()-1,1),J=new Date(l.getFullYear(),l.getMonth()+2,0,23,59,59),{data:K,refetch:k}=p.calendar.getEvents.useQuery({startDate:X,endDate:J}),{data:W}=p.pets.list.useQuery(),Z=p.calendar.add.useMutation({onSuccess:()=>{d.success("Evento criado com sucesso!"),k()},onError:t=>{d.error(`Erro ao criar evento: ${t.message}`)}}),E=p.calendar.delete.useMutation({onSuccess:()=>{d.success("Evento excluído com sucesso!"),h(!1),f(null),k()},onError:t=>{d.error(`Erro ao excluir evento: ${t.message}`)}}),T=p.calendar.update.useMutation({onSuccess:()=>{d.success("Evento atualizado com sucesso!"),g(!1),h(!1),f(null),k()},onError:t=>{d.error(`Erro ao atualizar evento: ${t.message}`)}}),S=p.calendar.exportToICal.useMutation({onSuccess:t=>{const n=new Blob([t.icalContent],{type:"text/calendar"}),o=window.URL.createObjectURL(n),x=document.createElement("a");x.href=o,x.download="tucocare-calendar.ics",document.body.appendChild(x),x.click(),window.URL.revokeObjectURL(o),document.body.removeChild(x),d.success("Calendário exportado com sucesso!")},onError:t=>{d.error(`Erro ao exportar: ${t.message}`)}}),v=K?.map(t=>({id:t.id,title:t.title,description:t.description,eventDate:new Date(t.eventDate),endDate:t.endDate?new Date(t.endDate):null,eventType:t.eventType,petId:t.petId,petName:void 0,location:t.location,isAllDay:t.isAllDay}))||[],M=W?.map(t=>({id:t.id,name:t.name}))||[],_=v.filter(t=>{const n=new Date(t.eventDate);return n.getMonth()===l.getMonth()&&n.getFullYear()===l.getFullYear()}),ee=v.filter(t=>{const n=new Date(t.eventDate),o=new Date;return o.setDate(o.getDate()+30),t.eventType==="vaccination"&&n>=l&&n<=o}),te=v.filter(t=>{const n=new Date(t.eventDate);return n.getDate()===l.getDate()&&n.getMonth()===l.getMonth()&&n.getFullYear()===l.getFullYear()}),A=u?v.filter(t=>{const n=new Date(t.eventDate);return n.getDate()===u.getDate()&&n.getMonth()===u.getMonth()&&n.getFullYear()===u.getFullYear()}).sort((t,n)=>t.eventDate.getTime()-n.eventDate.getTime()):[],ae=t=>{Z.mutate({title:t.title,description:t.description||void 0,eventDate:t.eventDate,endDate:t.endDate||void 0,eventType:t.eventType,petId:t.petId||void 0,location:t.location||void 0,isAllDay:t.isAllDay})},P=t=>{f(t),g(!1),h(!0)},se=()=>{a&&E.mutate({id:a.id,petId:a.petId||void 0,title:a.title})},L=()=>{a&&(r({title:a.title,description:a.description||"",eventDate:a.eventDate,endDate:a.endDate||void 0,eventType:a.eventType,petId:a.petId||void 0,location:a.location||"",isAllDay:a.isAllDay}),g(!0))},ne=()=>{!a||!s.title||T.mutate({id:a.id,title:s.title,description:s.description||void 0,eventDate:s.eventDate,endDate:s.endDate||void 0,eventType:s.eventType,petId:s.petId||void 0,location:s.location||void 0,isAllDay:s.isAllDay})},re=()=>{g(!1),r({})},le=t=>{F(t)},ie=()=>{const t=new Date,n=new Date(t.getFullYear(),t.getMonth()-1,1),o=new Date(t.getFullYear(),t.getMonth()+2,0,23,59,59);S.mutate({startDate:n,endDate:o})},B=t=>({vaccination:"Vacinação",medication:"Medicamento",medical:"Consulta Médica",general:"Geral",holiday:"Feriado",closure:"Fechamento",checkin:"Check-in",checkout:"Check-out",preventive:"Preventivo"})[t]||t;return e.jsx(pe,{children:e.jsxs("div",{className:"container py-8 space-y-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold tracking-tight",children:"Calendário Geral"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Gerencie todos os eventos, vacinas, medicamentos e compromissos da creche"})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-3",children:[e.jsxs(D,{className:"border-2 hover:shadow-lg transition-shadow",children:[e.jsx(N,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(y,{className:"text-sm font-medium text-muted-foreground",children:"Eventos este Mês"}),e.jsx(fe,{className:"h-5 w-5 text-blue-500"})]})}),e.jsxs(w,{children:[e.jsx("div",{className:"text-3xl font-bold text-blue-600",children:_.length}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Agendados para ",l.toLocaleDateString("pt-BR",{month:"long"})]})]})]}),e.jsxs(D,{className:"border-2 hover:shadow-lg transition-shadow",children:[e.jsx(N,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(y,{className:"text-sm font-medium text-muted-foreground",children:"Vacinas Próximas"}),e.jsx(oe,{className:"h-5 w-5 text-orange-500"})]})}),e.jsxs(w,{children:[e.jsx("div",{className:"text-3xl font-bold text-orange-600",children:ee.length}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Próximos 30 dias"})]})]}),e.jsxs(D,{className:"border-2 hover:shadow-lg transition-shadow",children:[e.jsx(N,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(y,{className:"text-sm font-medium text-muted-foreground",children:"Eventos Hoje"}),e.jsx(de,{className:"h-5 w-5 text-green-500"})]})}),e.jsxs(w,{children:[e.jsx("div",{className:"text-3xl font-bold text-green-600",children:te.length}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Agendados para hoje"})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(c,{variant:"outline",onClick:ie,disabled:S.isPending,children:S.isPending?"Exportando...":e.jsxs(e.Fragment,{children:[e.jsx(be,{className:"mr-2 h-4 w-4"}),"Exportar para Google Calendar"]})})}),e.jsx(ge,{events:v,onEventClick:P,onCreateEvent:ae,onDayClick:le,pets:M,showCreateButton:!0,role:"admin"}),u&&e.jsxs(D,{className:"border-2 shadow-xl",children:[e.jsx(N,{className:"bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-950/20 dark:to-purple-950/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(I,{className:"h-6 w-6 text-primary"}),e.jsxs("div",{children:[e.jsx(y,{className:"text-2xl",children:"Agenda do Dia"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:u.toLocaleDateString("pt-BR",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]})]}),e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>F(null),className:"rounded-full",children:e.jsx(O,{className:"h-5 w-5"})})]})}),e.jsx(w,{className:"pt-6",children:A.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(I,{className:"h-16 w-16 text-muted-foreground/30 mx-auto mb-4"}),e.jsx("p",{className:"text-lg font-medium text-muted-foreground",children:"Nenhum evento agendado para este dia"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:'Clique em "Novo Evento" para adicionar um compromisso'})]}):e.jsx("div",{className:"space-y-4",children:A.map((t,n)=>{const o={vaccination:"border-blue-500 bg-blue-50 dark:bg-blue-950/20",medication:"border-purple-500 bg-purple-50 dark:bg-purple-950/20",medical:"border-red-500 bg-red-50 dark:bg-red-950/20",general:"border-gray-500 bg-gray-50 dark:bg-gray-950/20",holiday:"border-green-500 bg-green-50 dark:bg-green-950/20",closure:"border-orange-500 bg-orange-50 dark:bg-orange-950/20",checkin:"border-emerald-500 bg-emerald-50 dark:bg-emerald-950/20",checkout:"border-amber-500 bg-amber-50 dark:bg-amber-950/20",preventive:"border-cyan-500 bg-cyan-50 dark:bg-cyan-950/20"};return e.jsx("div",{className:`p-4 rounded-xl border-l-4 ${o[t.eventType]} hover:shadow-md transition-all cursor-pointer`,onClick:()=>P(t),children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[!t.isAllDay&&e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold",children:[e.jsx(q,{className:"h-4 w-4"}),t.eventDate.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})]}),e.jsx(Y,{variant:"secondary",className:"text-xs",children:B(t.eventType)})]}),e.jsx("h3",{className:"font-semibold text-lg",children:t.title}),t.description&&e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:t.description}),e.jsxs("div",{className:"flex flex-wrap gap-3 text-sm text-muted-foreground",children:[t.location&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(G,{className:"h-3.5 w-3.5"}),t.location]}),t.petId&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(R,{className:"h-3.5 w-3.5"}),"Pet ID: ",t.petId]})]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(c,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded-full",onClick:x=>{x.stopPropagation(),f(t),L(),h(!0)},children:e.jsx(U,{className:"h-4 w-4"})})})]})},t.id)})})})]}),e.jsx(ce,{open:Q,onOpenChange:t=>{h(t),t||(g(!1),r({}))},children:e.jsxs(me,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(xe,{children:[e.jsxs(he,{className:"text-2xl flex items-center gap-3",children:[e.jsx(I,{className:"h-6 w-6 text-primary"}),b?"Editar Evento":a?.title]}),e.jsx(ue,{children:b?"Modifique as informações do evento":"Detalhes do evento"})]}),a&&!b&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{children:e.jsx(Y,{variant:"secondary",className:"text-sm px-3 py-1",children:B(a.eventType)})}),a.description&&e.jsxs("div",{className:"bg-muted/50 p-4 rounded-xl",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Descrição"}),e.jsx("p",{className:"text-muted-foreground whitespace-pre-wrap",children:a.description})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-blue-50 dark:bg-blue-950/20 rounded-xl border-2 border-blue-200 dark:border-blue-800",children:[e.jsx(q,{className:"h-5 w-5 text-blue-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-blue-900 dark:text-blue-100",children:a.eventDate.toLocaleDateString("pt-BR",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}),a.isAllDay?e.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300 mt-1",children:"Dia inteiro"}):e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300 mt-1",children:["Horário: ",a.eventDate.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})]})]})]}),a.location&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-purple-50 dark:bg-purple-950/20 rounded-xl border-2 border-purple-200 dark:border-purple-800",children:[e.jsx(G,{className:"h-5 w-5 text-purple-600"}),e.jsx("span",{className:"font-medium text-purple-900 dark:text-purple-100",children:a.location})]}),a.petId&&e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-green-50 dark:bg-green-950/20 rounded-xl border-2 border-green-200 dark:border-green-800",children:[e.jsx(R,{className:"h-5 w-5 text-green-600"}),e.jsxs("span",{className:"font-medium text-green-900 dark:text-green-100",children:["Pet ID: ",a.petId,a.petName&&` - ${a.petName}`]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx(c,{variant:"outline",onClick:()=>h(!1),className:"rounded-xl",children:"Fechar"}),e.jsxs(c,{variant:"default",onClick:L,className:"rounded-xl",children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Editar"]}),e.jsxs(c,{variant:"destructive",onClick:se,disabled:E.isPending,className:"rounded-xl shadow-lg hover:shadow-xl transition-all",children:[e.jsx(De,{className:"h-4 w-4 mr-2"}),E.isPending?"Excluindo...":"Excluir"]})]})]}),b&&a&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"edit-title",children:"Título *"}),e.jsx(C,{id:"edit-title",value:s.title||"",onChange:t=>r({...s,title:t.target.value}),className:"rounded-xl mt-1.5",placeholder:"Ex: Vacinação Antirrábica"})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"edit-description",children:"Descrição"}),e.jsx(ve,{id:"edit-description",value:s.description||"",onChange:t=>r({...s,description:t.target.value}),className:"rounded-xl mt-1.5",rows:3,placeholder:"Detalhes adicionais sobre o evento..."})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"edit-type",children:"Tipo de Evento *"}),e.jsxs(V,{value:s.eventType,onValueChange:t=>r({...s,eventType:t}),children:[e.jsx(z,{className:"rounded-xl mt-1.5",children:e.jsx(H,{})}),e.jsxs($,{children:[e.jsx(i,{value:"general",children:"Geral"}),e.jsx(i,{value:"vaccination",children:"Vacinação"}),e.jsx(i,{value:"medication",children:"Medicamento"}),e.jsx(i,{value:"preventive",children:"Preventivo"}),e.jsx(i,{value:"medical",children:"Consulta Médica"}),e.jsx(i,{value:"checkin",children:"Check-in"}),e.jsx(i,{value:"checkout",children:"Check-out"}),e.jsx(i,{value:"holiday",children:"Feriado"}),e.jsx(i,{value:"closure",children:"Fechamento"})]})]})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"edit-pet",children:"Pet (opcional)"}),e.jsxs(V,{value:s.petId?.toString()||"none",onValueChange:t=>r({...s,petId:t==="none"?void 0:Number(t)}),children:[e.jsx(z,{className:"rounded-xl mt-1.5",children:e.jsx(H,{})}),e.jsxs($,{children:[e.jsx(i,{value:"none",children:"Nenhum pet"}),M.map(t=>e.jsx(i,{value:t.id.toString(),children:t.name},t.id))]})]})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"edit-date",children:"Data e Hora de Início *"}),e.jsx(C,{id:"edit-date",type:"datetime-local",value:s.eventDate?new Date(s.eventDate.getTime()-s.eventDate.getTimezoneOffset()*6e4).toISOString().slice(0,16):"",onChange:t=>r({...s,eventDate:new Date(t.target.value)}),className:"rounded-xl mt-1.5"})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"edit-end-date",children:"Data e Hora de Término (Opcional)"}),e.jsx(C,{id:"edit-end-date",type:"datetime-local",value:s.endDate?new Date(s.endDate.getTime()-s.endDate.getTimezoneOffset()*6e4).toISOString().slice(0,16):"",onChange:t=>r({...s,endDate:t.target.value?new Date(t.target.value):void 0}),className:"rounded-xl mt-1.5"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1.5",children:"Para eventos que duram vários dias (ex: hospedagem, viagem)"})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"edit-location",children:"Local"}),e.jsx(C,{id:"edit-location",value:s.location||"",onChange:t=>r({...s,location:t.target.value}),placeholder:"Ex: Clínica Veterinária",className:"rounded-xl mt-1.5"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(je,{id:"edit-allday",checked:s.isAllDay||!1,onCheckedChange:t=>r({...s,isAllDay:t})}),e.jsx(m,{htmlFor:"edit-allday",className:"cursor-pointer",children:"Evento de dia inteiro"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsxs(c,{variant:"outline",onClick:re,className:"rounded-xl",children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"Cancelar"]}),e.jsxs(c,{onClick:ne,disabled:T.isPending||!s.title,className:"rounded-xl shadow-lg hover:shadow-xl transition-all",children:[e.jsx(Ne,{className:"h-4 w-4 mr-2"}),T.isPending?"Salvando...":"Salvar Alterações"]})]})]})]})})]})})}export{Ze as default};
