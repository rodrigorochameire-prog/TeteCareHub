import{r,t as q,a as i,j as e,o as R,A as X,B as d,p as B,q as M,s as U,v as V,X as _,h,I as k}from"./index-DG0yx2hi.js";import{T as z}from"./textarea-BfRN5q_Y.js";import{S as G,a as W,b as $,c as H,d as J}from"./select-k5kl2mY3.js";import{P as Y}from"./progress-BQ_EYLtW.js";import{U as S}from"./upload-Ck_fQFtx.js";import{F as Z}from"./popover-Bqiz4euq.js";const K=[{value:"vaccination_card",label:"Carteira de Vacinação"},{value:"exam",label:"Exame"},{value:"prescription",label:"Receita"},{value:"certificate",label:"Certificado"},{value:"veterinary_document",label:"Documento Veterinário"},{value:"other",label:"Outro"}],Q=25*1024*1024,ee=["application/pdf","image/jpeg","image/png","image/jpg","image/webp","image/heic","image/heif","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","text/plain","text/csv"];function ne({petId:y,onUploadSuccess:N}){const[C,m]=r.useState(!1),[E,u]=r.useState(!1),[s,p]=r.useState(null),[x,g]=r.useState(""),[f,v]=r.useState(""),[n,j]=r.useState(""),[l,o]=r.useState(0),D=r.useRef(null),c=q.documents.upload.useMutation({onSuccess:()=>{i.success("Documento enviado com sucesso!"),m(!1),T(),N?.()},onError:a=>{i.error(a.message||"Erro ao enviar documento"),o(0)}}),T=()=>{p(null),g(""),v(""),j(""),o(0)},F=a=>{a.preventDefault(),u(!0)},P=()=>{u(!1)},O=a=>{a.preventDefault(),u(!1);const t=a.dataTransfer.files[0];t&&b(t)},w=a=>{const t=a.target.files?.[0];t&&b(t)},b=a=>{if(!ee.includes(a.type)){i.error("Tipo de arquivo não permitido. Use PDF, imagens (JPG, PNG, WEBP), documentos do Office (DOC, DOCX, XLS, XLSX) ou arquivos de texto (TXT, CSV).");return}if(a.size>Q){i.error("Arquivo muito grande. Tamanho máximo: 25MB");return}p(a),x||g(a.name.replace(/\.[^/.]+$/,""))},I=async a=>{if(a.preventDefault(),!s||!n){i.error("Preencha todos os campos obrigatórios");return}o(10);const t=new FileReader;t.onload=async A=>{const L=A.target?.result;o(50),c.mutate({petId:y,title:x,description:f,category:n,fileData:L,fileName:s.name,mimeType:s.type}),o(100)},t.readAsDataURL(s)};return e.jsxs(R,{open:C,onOpenChange:m,children:[e.jsx(X,{asChild:!0,children:e.jsxs(d,{children:[e.jsx(S,{className:"mr-2 h-4 w-4"}),"Enviar Documento"]})}),e.jsxs(B,{className:"max-w-2xl",children:[e.jsxs(M,{children:[e.jsx(U,{children:"Enviar Documento"}),e.jsx(V,{children:"Faça upload de documentos veterinários, exames ou certificados"})]}),e.jsxs("form",{onSubmit:I,className:"space-y-4",children:[e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-8 text-center transition-colors ${E?"border-primary bg-primary/5":"border-border hover:border-primary/50"}`,onDragOver:F,onDragLeave:P,onDrop:O,onClick:()=>D.current?.click(),children:[e.jsx("input",{ref:D,type:"file",accept:".pdf,.jpg,.jpeg,.png,.webp,.heic,.heif,.doc,.docx,.xls,.xlsx,.txt,.csv",onChange:w,className:"hidden"}),s?e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsx(Z,{className:"h-8 w-8 text-primary"}),e.jsxs("div",{className:"text-left flex-1",children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[(s.size/1024/1024).toFixed(2)," MB"]})]}),e.jsx(d,{type:"button",variant:"ghost",size:"sm",onClick:a=>{a.stopPropagation(),p(null)},children:e.jsx(_,{className:"h-4 w-4"})})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{className:"h-12 w-12 mx-auto text-muted-foreground"}),e.jsx("p",{className:"text-sm font-medium",children:"Arraste um arquivo ou clique para selecionar"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"PDF, Imagens, Office ou Texto até 25MB"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"title",children:"Título *"}),e.jsx(k,{id:"title",value:x,onChange:a=>g(a.target.value),placeholder:"Ex: Carteira de Vacinação 2024",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"category",children:"Categoria *"}),e.jsxs(G,{value:n,onValueChange:j,required:!0,children:[e.jsx(W,{children:e.jsx($,{placeholder:"Selecione a categoria"})}),e.jsx(H,{children:K.map(a=>e.jsx(J,{value:a.value,children:a.label},a.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"description",children:"Descrição"}),e.jsx(z,{id:"description",value:f,onChange:a=>v(a.target.value),placeholder:"Adicione observações sobre este documento...",rows:3})]}),l>0&&l<100&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(Y,{value:l}),e.jsxs("p",{className:"text-sm text-center text-muted-foreground",children:["Enviando... ",l,"%"]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(d,{type:"button",variant:"outline",onClick:()=>m(!1),disabled:c.isPending,children:"Cancelar"}),e.jsx(d,{type:"submit",disabled:!s||!n||c.isPending,children:c.isPending?"Enviando...":"Enviar Documento"})]})]})]})]})}export{ne as D};
