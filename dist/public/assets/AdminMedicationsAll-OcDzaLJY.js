import{r,u as G,t as p,a as M,j as e,B as v,C as o,f as d,I as F,b as J,d as K,e as U,o as W,p as Y,q as Z,s as _,v as $,h as y,w as ee,X as se}from"./index-DG0yx2hi.js";import{A as te}from"./AdminLayout-CapzJ-JK.js";import{P as m,B as L}from"./popover-Bqiz4euq.js";import{S as w,a as D,b as C,c as T,d as i}from"./select-k5kl2mY3.js";import{T as ae,a as ie,b as E,c as n,d as ne,e as l}from"./table-DeOYaLOA.js";import{R as le}from"./RecentChangeIndicator-dH2jnUR2.js";import{T as ce}from"./textarea-BfRN5q_Y.js";import{A as re}from"./arrow-left-B-xkxJNp.js";import{S as oe}from"./search-DtaYG9vz.js";import{S as de}from"./square-pen-D7F5zf6L.js";import{S as me}from"./save-Cc15p_sb.js";import"./scroll-area-C0S6gB82.js";import"./index-BdQq_4o_.js";import"./layout-dashboard-CC4g-mOh.js";import"./wallet-CKmMh37E.js";import"./users-DD1qYPM2.js";import"./user-B4BzRHVK.js";import"./index-r4-iOF84.js";import"./chevron-down-CKVtRMqG.js";import"./check-DDByOptX.js";import"./clock-BQzFMz2h.js";function Pe(){const[f,P]=r.useState(""),[x,B]=r.useState("all"),[g,z]=r.useState("all"),[a,A]=r.useState(null),[V,h]=r.useState(!1),[,R]=G(),{data:H,refetch:O}=p.pets.list.useQuery(),{data:I}=p.changeHistory.getRecentChanges.useQuery({limit:200}),N=p.medications.update.useMutation({onSuccess:()=>{M.success("Medicamento atualizado com sucesso!"),h(!1),A(null),O()},onError:s=>{M.error("Erro ao atualizar medicamento: "+s.message)}}),k=s=>{A(s),h(!0)},q=s=>{s.preventDefault();const t=new FormData(s.currentTarget),c=t.get("isActive")==="true",u=t.get("endDate"),X=t.get("notes");N.mutate({id:a.medication.id,petId:a.petId,isActive:c,endDate:u?new Date(u):void 0,notes:X||void 0})},j=(H?.map(s=>{const{data:t}=p.medications.getPetMedications.useQuery({petId:s.id});return{pet:s,medications:t||[]}}).filter(Boolean)||[]).flatMap(({pet:s,medications:t})=>t.map(c=>({...c,petName:s.name,petId:s.id}))),b=j.filter(s=>{const t=s.petName.toLowerCase().includes(f.toLowerCase())||s.medicationInfo.name.toLowerCase().includes(f.toLowerCase()),c=x==="all"||x==="active"&&s.medication.isActive||x==="inactive"&&!s.medication.isActive,u=g==="all"||s.medicationInfo.type===g;return t&&c&&u}),Q=s=>I?I.filter(t=>t.resourceType==="medication"&&t.resourceId===s).slice(0,3):[],S={total:j.length,active:j.filter(s=>s.medication.isActive).length,inactive:j.filter(s=>!s.medication.isActive).length};return e.jsxs(te,{children:[e.jsxs("div",{className:"container mx-auto py-8",children:[e.jsxs("div",{className:"mb-8 flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold mb-2",children:"Medicamentos - Todos os Pets"}),e.jsx("p",{className:"text-muted-foreground",children:"Visualize e gerencie medicamentos de todos os pets cadastrados"})]}),e.jsxs(v,{variant:"outline",onClick:()=>R("/admin/medications"),children:[e.jsx(re,{className:"mr-2 h-4 w-4"}),"Voltar para Biblioteca"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsx(o,{children:e.jsx(d,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total"}),e.jsx("p",{className:"text-3xl font-bold",children:S.total})]}),e.jsx(m,{className:"h-10 w-10 text-primary"})]})})}),e.jsx(o,{children:e.jsx(d,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ativos"}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:S.active})]}),e.jsx(m,{className:"h-10 w-10 text-green-600"})]})})}),e.jsx(o,{children:e.jsx(d,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Finalizados"}),e.jsx("p",{className:"text-3xl font-bold text-muted-foreground",children:S.inactive})]}),e.jsx(m,{className:"h-10 w-10 text-muted-foreground"})]})})})]}),e.jsx(o,{className:"mb-6",children:e.jsx(d,{className:"pt-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(oe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(F,{placeholder:"Buscar por pet ou medicamento...",value:f,onChange:s=>P(s.target.value),className:"pl-10"})]}),e.jsxs(w,{value:x,onValueChange:B,children:[e.jsx(D,{children:e.jsx(C,{placeholder:"Status"})}),e.jsxs(T,{children:[e.jsx(i,{value:"all",children:"Todos os status"}),e.jsx(i,{value:"active",children:"Ativos"}),e.jsx(i,{value:"inactive",children:"Finalizados"})]})]}),e.jsxs(w,{value:g,onValueChange:z,children:[e.jsx(D,{children:e.jsx(C,{placeholder:"Tipo"})}),e.jsxs(T,{children:[e.jsx(i,{value:"all",children:"Todos os tipos"}),e.jsx(i,{value:"preventive",children:"Preventivo"}),e.jsx(i,{value:"treatment",children:"Tratamento"}),e.jsx(i,{value:"supplement",children:"Suplemento"})]})]})]})})}),e.jsxs(o,{children:[e.jsxs(J,{children:[e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(m,{className:"h-5 w-5"}),"Medicamentos (",b.length,")"]}),e.jsx(U,{children:"Lista completa de medicamentos de todos os pets"})]}),e.jsx(d,{children:b.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(m,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-lg font-medium",children:"Nenhum medicamento encontrado"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ajuste os filtros ou adicione medicamentos aos pets"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(ae,{children:[e.jsx(ie,{children:e.jsxs(E,{children:[e.jsx(n,{children:"Pet"}),e.jsx(n,{children:"Medicamento"}),e.jsx(n,{children:"Tipo"}),e.jsx(n,{children:"Dosagem"}),e.jsx(n,{children:"Frequência"}),e.jsx(n,{children:"Início"}),e.jsx(n,{children:"Status"}),e.jsx(n,{children:"Alterações"}),e.jsx(n,{children:"Ações"})]})}),e.jsx(ne,{children:b.map(s=>e.jsxs(E,{children:[e.jsx(l,{className:"font-medium",children:s.petName}),e.jsx(l,{children:s.medicationInfo.name}),e.jsx(l,{children:e.jsx(L,{variant:"outline",children:s.medicationInfo.type})}),e.jsx(l,{children:s.medication.dosage}),e.jsx(l,{children:s.medication.frequency||"-"}),e.jsx(l,{children:new Date(s.medication.startDate).toLocaleDateString("pt-BR")}),e.jsx(l,{children:e.jsx(L,{variant:s.medication.isActive?"default":"secondary",children:s.medication.isActive?"Ativo":"Finalizado"})}),e.jsx(l,{children:e.jsx(le,{changes:Q(s.medication.id),resourceType:"medication"})}),e.jsx(l,{children:e.jsx(v,{size:"sm",variant:"ghost",onClick:()=>k(s),children:e.jsx(de,{className:"h-4 w-4"})})})]},s.medication.id))})]})})})]})]}),e.jsx(W,{open:V,onOpenChange:h,children:e.jsxs(Y,{className:"max-w-md",children:[e.jsxs(Z,{children:[e.jsx(_,{children:"Editar Medicamento"}),e.jsx($,{children:a&&e.jsxs("span",{children:[a.medicationInfo.name," - ",a.petName]})})]}),a&&e.jsxs("form",{onSubmit:q,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"isActive",children:"Status"}),e.jsxs(w,{name:"isActive",defaultValue:a.medication.isActive?"true":"false",children:[e.jsx(D,{children:e.jsx(C,{})}),e.jsxs(T,{children:[e.jsx(i,{value:"true",children:"Ativo"}),e.jsx(i,{value:"false",children:"Finalizado"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"endDate",children:"Data Final"}),e.jsx(F,{id:"endDate",name:"endDate",type:"date",defaultValue:a.medication.endDate?new Date(a.medication.endDate).toISOString().split("T")[0]:""})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"notes",children:"Observações"}),e.jsx(ce,{id:"notes",name:"notes",rows:3,defaultValue:a.medication.notes||"",placeholder:"Adicione observações sobre o tratamento..."})]})]}),e.jsxs(ee,{className:"mt-6",children:[e.jsxs(v,{type:"button",variant:"outline",onClick:()=>h(!1),children:[e.jsx(se,{className:"mr-2 h-4 w-4"}),"Cancelar"]}),e.jsxs(v,{type:"submit",disabled:N.isPending,children:[e.jsx(me,{className:"mr-2 h-4 w-4"}),N.isPending?"Salvando...":"Salvar"]})]})]})]})})]})}export{Pe as default};
