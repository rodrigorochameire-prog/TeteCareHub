import{r as o,t as c,a as r,j as e,S as m,C as k,b as z,d as H,e as M,o as R,A as Ne,B as u,p as q,q as _,s as Q,v as U,h as d,I as x,w as W,f as G}from"./index-DG0yx2hi.js";import{A as be}from"./AdminLayout-CapzJ-JK.js";import{T as J}from"./textarea-BfRN5q_Y.js";import{T as we,a as Te,b as K,c as X}from"./tabs-sUy1g-fW.js";import{S as y,a as D,b as N,c as b,d as t}from"./select-k5kl2mY3.js";import{T as Y,a as Z,b as w,c as i,d as $,e as l}from"./table-DeOYaLOA.js";import{B as ee}from"./popover-Bqiz4euq.js";import{R as Ce}from"./RecentChangeIndicator-dH2jnUR2.js";import{H as Se}from"./history-BxnlJaOb.js";import{P as Pe}from"./plus-DIKUpKHa.js";import{S as Ae}from"./search-DtaYG9vz.js";import{F as V}from"./filter-C966fxzX.js";import{S as Fe}from"./square-pen-D7F5zf6L.js";import{T as Ee}from"./trash-2-6I2MbiK3.js";import{W as Ve}from"./worm-BunGZuKV.js";import{B as Be}from"./bug-Q7u3vQpS.js";import"./scroll-area-C0S6gB82.js";import"./index-BdQq_4o_.js";import"./layout-dashboard-CC4g-mOh.js";import"./wallet-CKmMh37E.js";import"./users-DD1qYPM2.js";import"./user-B4BzRHVK.js";import"./index-r4-iOF84.js";import"./chevron-down-CKVtRMqG.js";import"./check-DDByOptX.js";import"./clock-BQzFMz2h.js";function os(){const[se,ae]=o.useState("library"),[te,T]=o.useState(!1),[B,re]=o.useState(""),[C,ie]=o.useState(""),[S,le]=o.useState("all"),[p,ne]=o.useState("all"),[P,oe]=o.useState("all"),[j,A]=o.useState(null),[ce,v]=o.useState(!1),{data:F,refetch:de}=c.preventives.library.useQuery(),{data:I,refetch:g}=c.pets.list.useQuery(),{data:me}=c.changeHistory.getRecentChanges.useQuery({limit:200}),ue=c.preventives.addToLibrary.useMutation({onSuccess:()=>{r.success("Preventivo adicionado à biblioteca!"),T(!1),de()},onError:s=>{r.error(s.message||"Erro ao adicionar preventivo")}}),he=c.preventives.updateFlea.useMutation({onSuccess:()=>{r.success("Antipulgas atualizado!"),v(!1),A(null),g()},onError:s=>{r.error(s.message||"Erro ao atualizar antipulgas")}}),xe=c.preventives.deleteFlea.useMutation({onSuccess:()=>{r.success("Antipulgas removido!"),g()},onError:s=>{r.error(s.message||"Erro ao remover antipulgas")}}),pe=c.preventives.updateDeworming.useMutation({onSuccess:()=>{r.success("Vermífugo atualizado!"),v(!1),A(null),g()},onError:s=>{r.error(s.message||"Erro ao atualizar vermífugo")}}),je=c.preventives.deleteDeworming.useMutation({onSuccess:()=>{r.success("Vermífugo removido!"),g()},onError:s=>{r.error(s.message||"Erro ao remover vermífugo")}}),ve=s=>{s.preventDefault();const a=new FormData(s.currentTarget);ue.mutate({name:a.get("name"),type:B,manufacturer:a.get("manufacturer")||void 0,intervalDays:a.get("intervalDays")?parseInt(a.get("intervalDays")):void 0,notes:a.get("notes")||void 0})},fe=s=>{s.preventDefault();const a=new FormData(s.currentTarget),n={id:j.id,applicationDate:a.get("applicationDate"),nextDueDate:a.get("nextDueDate")||void 0,notes:a.get("notes")||void 0};j.type==="flea"?he.mutate(n):pe.mutate(n)},ge=(s,a)=>{confirm("Tem certeza que deseja remover este preventivo?")&&(a==="flea"?xe.mutate({id:s}):je.mutate({id:s}))},O=(I?.flatMap(s=>(s.preventives||[]).map(a=>({...a,petName:s.name,petId:s.id})))||[]).filter(s=>{const a=s.preventive?.name?.toLowerCase().includes(C.toLowerCase())||s.petName.toLowerCase().includes(C.toLowerCase()),n=S==="all"||s.preventive?.type===S,f=P==="all"||s.petId.toString()===P;let h=!0;if(p!=="all"&&s.applicationDate){const De=new Date(s.applicationDate),E=Math.floor((new Date().getTime()-De.getTime())/(1e3*60*60*24));p==="7days"?h=E<=7:p==="30days"?h=E<=30:p==="90days"&&(h=E<=90)}return a&&n&&f&&h}),L=s=>{const a={flea_tick:"default",heartworm:"secondary",deworming:"outline",other:"outline"},n={flea_tick:"Pulgas e Carrapatos",heartworm:"Vermes do Coração",deworming:"Vermífugo",other:"Outro"},h={flea_tick:Be,heartworm:m,deworming:Ve,other:m}[s]||m;return e.jsxs(ee,{variant:a[s]||"outline",className:"gap-1",children:[e.jsx(h,{className:"h-3 w-3"}),n[s]||s]})},ye=s=>s?new Date(s)<new Date:!1;return e.jsx(be,{children:e.jsxs("div",{className:"container py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold",children:"Preventivos"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Gerencie a biblioteca de preventivos e aplicações"})]}),e.jsx(m,{className:"h-12 w-12 text-primary"})]}),e.jsxs(we,{value:se,onValueChange:ae,className:"space-y-6",children:[e.jsxs(Te,{className:"grid w-full grid-cols-2 max-w-md",children:[e.jsxs(K,{value:"library",children:[e.jsx(m,{className:"h-4 w-4 mr-2"}),"Biblioteca"]}),e.jsxs(K,{value:"applications",children:[e.jsx(Se,{className:"h-4 w-4 mr-2"}),"Aplicações"]})]}),e.jsx(X,{value:"library",className:"space-y-6",children:e.jsxs(k,{children:[e.jsx(z,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(H,{children:"Biblioteca de Preventivos"}),e.jsx(M,{children:"Produtos preventivos pré-cadastrados para uso rápido"})]}),e.jsxs(R,{open:te,onOpenChange:T,children:[e.jsx(Ne,{asChild:!0,children:e.jsxs(u,{children:[e.jsx(Pe,{className:"h-4 w-4 mr-2"}),"Adicionar Preventivo"]})}),e.jsx(q,{children:e.jsxs("form",{onSubmit:ve,children:[e.jsxs(_,{children:[e.jsx(Q,{children:"Adicionar Preventivo à Biblioteca"}),e.jsx(U,{children:"Cadastre um novo produto preventivo para uso futuro"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"name",children:"Nome do Produto *"}),e.jsx(x,{id:"name",name:"name",placeholder:"Ex: Bravecto",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"type",children:"Tipo *"}),e.jsxs(y,{value:B,onValueChange:re,required:!0,children:[e.jsx(D,{children:e.jsx(N,{placeholder:"Selecione o tipo"})}),e.jsxs(b,{children:[e.jsx(t,{value:"flea_tick",children:"Pulgas e Carrapatos"}),e.jsx(t,{value:"heartworm",children:"Vermes do Coração"}),e.jsx(t,{value:"deworming",children:"Vermífugo"}),e.jsx(t,{value:"other",children:"Outro"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"manufacturer",children:"Fabricante"}),e.jsx(x,{id:"manufacturer",name:"manufacturer",placeholder:"Ex: Bayer"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"intervalDays",children:"Intervalo (dias)"}),e.jsx(x,{id:"intervalDays",name:"intervalDays",type:"number",placeholder:"Ex: 90"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"notes",children:"Observações"}),e.jsx(J,{id:"notes",name:"notes",placeholder:"Observações sobre o produto...",rows:3})]})]}),e.jsxs(W,{children:[e.jsx(u,{type:"button",variant:"outline",onClick:()=>T(!1),children:"Cancelar"}),e.jsx(u,{type:"submit",children:"Adicionar"})]})]})})]})]})}),e.jsx(G,{children:!F||F.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(m,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Nenhum preventivo cadastrado na biblioteca"})]}):e.jsxs(Y,{children:[e.jsx(Z,{children:e.jsxs(w,{children:[e.jsx(i,{children:"Nome"}),e.jsx(i,{children:"Tipo"}),e.jsx(i,{children:"Fabricante"}),e.jsx(i,{children:"Intervalo (dias)"})]})}),e.jsx($,{children:F.map(s=>e.jsxs(w,{children:[e.jsx(l,{className:"font-medium",children:s.name}),e.jsx(l,{children:L(s.type)}),e.jsx(l,{className:"text-sm text-muted-foreground",children:s.manufacturer||"-"}),e.jsx(l,{className:"text-sm text-muted-foreground",children:s.intervalDays||"-"})]},s.id))})]})})]})}),e.jsx(X,{value:"applications",className:"space-y-6",children:e.jsxs(k,{children:[e.jsxs(z,{children:[e.jsx(H,{children:"Aplicações de Preventivos"}),e.jsx(M,{children:"Todos os preventivos aplicados nos pets"})]}),e.jsxs(G,{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsx("div",{className:"flex-1 min-w-[200px]",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ae,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(x,{placeholder:"Buscar por produto ou pet...",value:C,onChange:s=>ie(s.target.value),className:"pl-10"})]})}),e.jsxs(y,{value:S,onValueChange:le,children:[e.jsxs(D,{className:"w-[220px]",children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),e.jsx(N,{})]}),e.jsxs(b,{children:[e.jsx(t,{value:"all",children:"Todos os Tipos"}),e.jsx(t,{value:"flea_tick",children:"Pulgas e Carrapatos"}),e.jsx(t,{value:"heartworm",children:"Vermes do Coração"}),e.jsx(t,{value:"deworming",children:"Vermífugo"}),e.jsx(t,{value:"other",children:"Outro"})]})]}),e.jsxs(y,{value:p,onValueChange:ne,children:[e.jsxs(D,{className:"w-[180px]",children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),e.jsx(N,{})]}),e.jsxs(b,{children:[e.jsx(t,{value:"all",children:"Todos os Períodos"}),e.jsx(t,{value:"7days",children:"Últimos 7 dias"}),e.jsx(t,{value:"30days",children:"Últimos 30 dias"}),e.jsx(t,{value:"90days",children:"Últimos 90 dias"})]})]}),e.jsxs(y,{value:P,onValueChange:oe,children:[e.jsxs(D,{className:"w-[180px]",children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),e.jsx(N,{})]}),e.jsxs(b,{children:[e.jsx(t,{value:"all",children:"Todos os Pets"}),I?.map(s=>e.jsx(t,{value:s.id.toString(),children:s.name},s.id))]})]})]}),O.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(m,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Nenhuma aplicação encontrada"})]}):e.jsxs(Y,{children:[e.jsx(Z,{children:e.jsxs(w,{children:[e.jsx(i,{children:"Pet"}),e.jsx(i,{children:"Produto"}),e.jsx(i,{children:"Tipo"}),e.jsx(i,{children:"Data de Aplicação"}),e.jsx(i,{children:"Próxima Aplicação"}),e.jsx(i,{className:"text-right",children:"Ações"})]})}),e.jsx($,{children:O.map(s=>{const a=me?.find(f=>f.entityType==="preventive"&&f.entityId===s.id),n=ye(s.nextDueDate);return e.jsxs(w,{children:[e.jsx(l,{className:"font-medium",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[s.petName,a?e.jsx(Ce,{changes:[a],resourceType:"preventive"}):null]})}),e.jsx(l,{children:s.preventive?.name||"-"}),e.jsx(l,{children:L(s.preventive?.type)}),e.jsx(l,{children:new Date(s.applicationDate).toLocaleDateString("pt-BR")}),e.jsx(l,{children:s.nextDueDate?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:n?"text-destructive font-medium":"",children:new Date(s.nextDueDate).toLocaleDateString("pt-BR")}),n&&e.jsx(ee,{variant:"destructive",className:"text-xs",children:"Atrasado"})]}):"-"}),e.jsx(l,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(u,{size:"sm",variant:"outline",onClick:()=>{A(s),v(!0)},children:e.jsx(Fe,{className:"h-4 w-4"})}),e.jsx(u,{size:"sm",variant:"destructive",onClick:()=>ge(s.id,s.preventive?.type),children:e.jsx(Ee,{className:"h-4 w-4"})})]})})]},s.id)})})]})]})]})})]}),e.jsx(R,{open:ce,onOpenChange:v,children:e.jsx(q,{children:e.jsxs("form",{onSubmit:fe,children:[e.jsxs(_,{children:[e.jsx(Q,{children:"Editar Aplicação de Preventivo"}),e.jsx(U,{children:"Atualize as informações da aplicação"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"edit-applicationDate",children:"Data de Aplicação *"}),e.jsx(x,{id:"edit-applicationDate",name:"applicationDate",type:"date",defaultValue:j?.applicationDate?.split("T")[0],required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"edit-nextDueDate",children:"Próxima Aplicação"}),e.jsx(x,{id:"edit-nextDueDate",name:"nextDueDate",type:"date",defaultValue:j?.nextDueDate?.split("T")[0]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"edit-notes",children:"Observações"}),e.jsx(J,{id:"edit-notes",name:"notes",defaultValue:j?.notes,placeholder:"Observações sobre a aplicação...",rows:3})]})]}),e.jsxs(W,{children:[e.jsx(u,{type:"button",variant:"outline",onClick:()=>v(!1),children:"Cancelar"}),e.jsx(u,{type:"submit",children:"Salvar Alterações"})]})]})})})]})})}export{os as default};
