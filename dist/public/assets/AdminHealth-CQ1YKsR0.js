import{r as l,t,a as n,j as e,S as H,C,b as A,d as M,e as L,B as h,f as E,I as N,n as je,o as fe,p as ge,q as ye,s as be,v as Ne,h as g,w as Te}from"./index-DG0yx2hi.js";import{A as De}from"./AdminLayout-CapzJ-JK.js";import{T as we}from"./textarea-BfRN5q_Y.js";import{T as R,a as k,b as p,c as I}from"./tabs-sUy1g-fW.js";import{S as V,a as P,b as F,c as z,d as c}from"./select-k5kl2mY3.js";import{T as Se,a as Ce,b as q,c as d,d as Ae,e as m}from"./table-DeOYaLOA.js";import{S as B,P as O,B as y}from"./popover-Bqiz4euq.js";import{P as Me}from"./plus-DIKUpKHa.js";import{S as Le}from"./search-DtaYG9vz.js";import{S as Ee}from"./square-pen-D7F5zf6L.js";import{T as Ie}from"./trash-2-6I2MbiK3.js";import{f as Ve,p as Pe}from"./pt-BR-BIS3WgEC.js";import"./scroll-area-C0S6gB82.js";import"./index-BdQq_4o_.js";import"./layout-dashboard-CC4g-mOh.js";import"./wallet-CKmMh37E.js";import"./users-DD1qYPM2.js";import"./user-B4BzRHVK.js";import"./index-r4-iOF84.js";import"./chevron-down-CKVtRMqG.js";import"./check-DDByOptX.js";function cs(){const[i,Q]=l.useState("vaccines"),[G,$]=l.useState("library"),[v,J]=l.useState(""),[T,K]=l.useState("all"),[D,U]=l.useState("all"),[W,u]=l.useState(!1),[Fe,x]=l.useState(!1),[ze,j]=l.useState(null),[w,X]=l.useState(""),{data:Y,refetch:Z}=t.vaccines.library.useQuery(),{data:_,refetch:ee}=t.medications.library.useQuery(),{data:se,refetch:ae}=t.preventives.library.useQuery(),{data:f,refetch:o}=t.pets.list.useQuery(),{data:Be}=t.changeHistory.getRecentChanges.useQuery({limit:200}),ie=t.vaccines.addToLibrary.useMutation({onSuccess:()=>{n.success("Vacina adicionada à biblioteca!"),u(!1),Z()},onError:s=>{n.error(s.message||"Erro ao adicionar vacina")}});t.vaccines.update.useMutation({onSuccess:()=>{n.success("Vacinação atualizada!"),x(!1),j(null),o()},onError:s=>{n.error(s.message||"Erro ao atualizar vacinação")}});const te=t.vaccines.delete.useMutation({onSuccess:()=>{n.success("Vacinação removida!"),o()}}),ne=t.medications.addToLibrary.useMutation({onSuccess:()=>{n.success("Medicamento adicionado à biblioteca!"),u(!1),ee()},onError:s=>{n.error(s.message||"Erro ao adicionar medicamento")}});t.medications.update.useMutation({onSuccess:()=>{n.success("Medicamento atualizado!"),x(!1),j(null),o()}});const re=t.medications.delete.useMutation({onSuccess:()=>{n.success("Medicamento removido!"),o()}}),ce=t.preventives.addToLibrary.useMutation({onSuccess:()=>{n.success("Preventivo adicionado à biblioteca!"),u(!1),ae()},onError:s=>{n.error(s.message||"Erro ao adicionar preventivo")}});t.preventives.updateFlea.useMutation({onSuccess:()=>{n.success("Antipulgas atualizado!"),x(!1),j(null),o()}});const le=t.preventives.deleteFlea.useMutation({onSuccess:()=>{n.success("Antipulgas removido!"),o()}});t.preventives.updateDeworming.useMutation({onSuccess:()=>{n.success("Vermífugo atualizado!"),x(!1),j(null),o()}});const oe=t.preventives.deleteDeworming.useMutation({onSuccess:()=>{n.success("Vermífugo removido!"),o()}}),de=()=>{if(!f)return[];let s=[];if(i==="vaccines"?f.forEach(a=>{a.vaccines?.forEach(r=>{s.push({...r,petName:a.name,petId:a.id,type:"vaccine"})})}):i==="medications"?f.forEach(a=>{a.medications?.forEach(r=>{s.push({...r,petName:a.name,petId:a.id,type:"medication"})})}):i==="preventives"&&f.forEach(a=>{a.fleaTreatments?.forEach(r=>{s.push({...r,petName:a.name,petId:a.id,type:"flea",preventiveType:"flea"})}),a.dewormings?.forEach(r=>{s.push({...r,petName:a.name,petId:a.id,type:"deworming",preventiveType:"deworming"})})}),T!=="all"&&(s=s.filter(a=>a.petId===parseInt(T))),v&&(s=s.filter(a=>a.petName?.toLowerCase().includes(v.toLowerCase())||a.name?.toLowerCase().includes(v.toLowerCase())||a.productName?.toLowerCase().includes(v.toLowerCase()))),D!=="all"){const a=new Date,S={"7days":7,"30days":30,"90days":90}[D];s=s.filter(b=>{const xe=new Date(b.administeredAt||b.lastApplication||b.applicationDate);return Math.floor((a.getTime()-xe.getTime())/(1e3*60*60*24))<=S})}return s.sort((a,r)=>{const S=new Date(a.administeredAt||a.lastApplication||a.applicationDate||0);return new Date(r.administeredAt||r.lastApplication||r.applicationDate||0).getTime()-S.getTime()})},me=s=>{s.preventDefault();const a=new FormData(s.currentTarget);i==="vaccines"?ie.mutate({name:a.get("name"),description:a.get("description")||void 0,intervalDays:a.get("intervalDays")?parseInt(a.get("intervalDays")):void 0,dosesRequired:1}):i==="medications"?ne.mutate({name:a.get("name"),type:w,description:a.get("description")||void 0,defaultDosage:a.get("defaultDosage")||void 0}):i==="preventives"&&ce.mutate({name:a.get("name"),type:w,description:a.get("description")||void 0,intervalDays:a.get("intervalDays")?parseInt(a.get("intervalDays")):void 0})},ue=s=>{j(s),x(!0)},he=s=>{confirm("Tem certeza que deseja remover este item?")&&(i==="vaccines"?te.mutate({id:s.id}):i==="medications"?re.mutate({id:s.id}):i==="preventives"&&(s.preventiveType==="flea"?le.mutate({id:s.id}):oe.mutate({id:s.id})))},pe=()=>i==="vaccines"?Y||[]:i==="medications"?_||[]:i==="preventives"?se||[]:[],ve=i==="vaccines"?B:i==="medications"?O:i==="preventives"?H:B;return e.jsx(De,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-3",children:[e.jsx(ve,{className:"h-8 w-8 text-primary"}),"Central de Saúde"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Gerencie vacinas, medicamentos e preventivos dos pets"})]})}),e.jsxs(R,{value:i,onValueChange:Q,className:"space-y-6",children:[e.jsxs(k,{className:"grid w-full grid-cols-3 lg:w-auto",children:[e.jsxs(p,{value:"vaccines",className:"flex items-center gap-2",children:[e.jsx(B,{className:"h-4 w-4"}),"Vacinas"]}),e.jsxs(p,{value:"medications",className:"flex items-center gap-2",children:[e.jsx(O,{className:"h-4 w-4"}),"Medicamentos"]}),e.jsxs(p,{value:"preventives",className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-4 w-4"}),"Preventivos"]})]}),(i==="vaccines"||i==="medications"||i==="preventives")&&e.jsxs(R,{value:G,onValueChange:$,className:"space-y-4",children:[e.jsxs(k,{children:[e.jsx(p,{value:"library",children:"Biblioteca"}),e.jsx(p,{value:"applications",children:"Aplicações"}),e.jsx(p,{value:"schedule",children:"Cronograma"})]}),e.jsx(I,{value:"library",className:"space-y-4",children:e.jsxs(C,{children:[e.jsxs(A,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(M,{children:["Biblioteca de ",i==="vaccines"?"Vacinas":i==="medications"?"Medicamentos":"Preventivos"]}),e.jsx(L,{children:"Gerencie os itens disponíveis para aplicação"})]}),e.jsxs(h,{onClick:()=>u(!0),children:[e.jsx(Me,{className:"h-4 w-4 mr-2"}),"Adicionar"]})]}),e.jsx(E,{children:e.jsx("div",{className:"grid gap-3",children:pe().map(s=>e.jsx("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-accent transition-colors",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:s.name}),s.description&&e.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:s.description}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[s.type&&e.jsx(y,{variant:"outline",children:s.type}),s.intervalDays&&e.jsxs(y,{variant:"secondary",children:["Reaplicar a cada ",s.intervalDays," dias"]})]})]})},s.id))})})]})}),e.jsx(I,{value:"applications",className:"space-y-4",children:e.jsxs(C,{children:[e.jsxs(A,{children:[e.jsx(M,{children:"Histórico de Aplicações"}),e.jsx(L,{children:"Visualize e gerencie todas as aplicações realizadas"})]}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Le,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(N,{placeholder:"Buscar por pet ou item...",value:v,onChange:s=>J(s.target.value),className:"pl-10"})]}),e.jsxs(V,{value:T,onValueChange:K,children:[e.jsx(P,{className:"w-full sm:w-[200px]",children:e.jsx(F,{placeholder:"Filtrar por pet"})}),e.jsxs(z,{children:[e.jsx(c,{value:"all",children:"Todos os pets"}),f?.map(s=>e.jsx(c,{value:s.id.toString(),children:s.name},s.id))]})]}),e.jsxs(V,{value:D,onValueChange:U,children:[e.jsx(P,{className:"w-full sm:w-[200px]",children:e.jsx(F,{placeholder:"Período"})}),e.jsxs(z,{children:[e.jsx(c,{value:"all",children:"Todo período"}),e.jsx(c,{value:"7days",children:"Últimos 7 dias"}),e.jsx(c,{value:"30days",children:"Últimos 30 dias"}),e.jsx(c,{value:"90days",children:"Últimos 90 dias"})]})]})]}),e.jsx("div",{className:"rounded-lg border",children:e.jsxs(Se,{children:[e.jsx(Ce,{children:e.jsxs(q,{children:[e.jsx(d,{children:"Pet"}),e.jsx(d,{children:"Item"}),e.jsx(d,{children:"Data"}),i==="vaccines"&&e.jsx(d,{children:"Status"}),i==="medications"&&e.jsx(d,{children:"Tipo"}),i==="preventives"&&e.jsx(d,{children:"Tipo"}),e.jsx(d,{children:"Ações"})]})}),e.jsx(Ae,{children:de().map(s=>e.jsxs(q,{children:[e.jsx(m,{className:"font-medium",children:s.petName}),e.jsx(m,{children:s.name||s.productName}),e.jsx(m,{children:Ve(new Date(s.administeredAt||s.lastApplication||s.applicationDate),"dd/MM/yyyy",{locale:Pe})}),i==="vaccines"&&e.jsx(m,{children:e.jsx(y,{variant:s.status==="completed"?"default":"secondary",children:s.status==="completed"?"Completo":"Pendente"})}),i==="medications"&&e.jsx(m,{children:e.jsx(y,{variant:"outline",children:s.type})}),i==="preventives"&&e.jsx(m,{children:e.jsx(y,{variant:"outline",children:s.preventiveType==="flea"?"Antipulgas":"Vermífugo"})}),e.jsx(m,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{size:"sm",variant:"ghost",onClick:()=>ue(s),children:e.jsx(Ee,{className:"h-4 w-4"})}),e.jsx(h,{size:"sm",variant:"ghost",onClick:()=>he(s),children:e.jsx(Ie,{className:"h-4 w-4 text-destructive"})})]})})]},`${s.type}-${s.id}`))})]})})]})]})}),e.jsx(I,{value:"schedule",className:"space-y-4",children:e.jsxs(C,{children:[e.jsxs(A,{children:[e.jsx(M,{children:"Cronograma de Aplicações"}),e.jsx(L,{children:"Próximas aplicações e alertas de vencimento"})]}),e.jsx(E,{children:e.jsx("div",{className:"flex items-center justify-center py-12 text-muted-foreground",children:e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx(je,{className:"h-12 w-12 mx-auto opacity-50"}),e.jsx("p",{children:"Visualização de cronograma integrada ao calendário principal"}),e.jsx(h,{variant:"link",onClick:()=>window.location.href="/admin/health-calendar",children:"Ir para Calendário"})]})})})]})})]})]}),e.jsx(fe,{open:W,onOpenChange:u,children:e.jsxs(ge,{children:[e.jsxs(ye,{children:[e.jsxs(be,{children:["Adicionar ",i==="vaccines"?"Vacina":i==="medications"?"Medicamento":"Preventivo"]}),e.jsx(Ne,{children:"Adicione um novo item à biblioteca"})]}),e.jsxs("form",{onSubmit:me,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"name",children:"Nome"}),e.jsx(N,{id:"name",name:"name",required:!0})]}),(i==="medications"||i==="preventives")&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"type",children:"Tipo"}),e.jsxs(V,{value:w,onValueChange:X,required:!0,children:[e.jsx(P,{children:e.jsx(F,{placeholder:"Selecione o tipo"})}),e.jsx(z,{children:i==="medications"?e.jsxs(e.Fragment,{children:[e.jsx(c,{value:"preventive",children:"Preventivo"}),e.jsx(c,{value:"treatment",children:"Tratamento"}),e.jsx(c,{value:"supplement",children:"Suplemento"})]}):e.jsxs(e.Fragment,{children:[e.jsx(c,{value:"flea",children:"Antipulgas"}),e.jsx(c,{value:"deworming",children:"Vermífugo"})]})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"description",children:"Descrição (opcional)"}),e.jsx(we,{id:"description",name:"description"})]}),(i==="vaccines"||i==="preventives")&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"intervalDays",children:"Intervalo de Reaplicação (dias)"}),e.jsx(N,{id:"intervalDays",name:"intervalDays",type:"number"})]}),i==="medications"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"defaultDosage",children:"Dosagem Padrão (opcional)"}),e.jsx(N,{id:"defaultDosage",name:"defaultDosage"})]}),e.jsxs(Te,{children:[e.jsx(h,{type:"button",variant:"outline",onClick:()=>u(!1),children:"Cancelar"}),e.jsx(h,{type:"submit",children:"Adicionar"})]})]})]})})]})})}export{cs as default};
