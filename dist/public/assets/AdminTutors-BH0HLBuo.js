import{m as L,r as i,t as d,a as o,j as e,C as b,I as f,n as H,B as a,o as E,p as I,q as M,s as T,h as c,D as J,w as z}from"./index-DG0yx2hi.js";import{A as K}from"./AdminLayout-CapzJ-JK.js";import{B as X}from"./popover-Bqiz4euq.js";import{U as B}from"./user-B4BzRHVK.js";import{S as Y}from"./search-DtaYG9vz.js";import{M as Z}from"./mail-DVbdA7bp.js";import{P as _}from"./phone-DTR97RUp.js";import{S as ee}from"./square-pen-D7F5zf6L.js";import{f as se,p as te}from"./pt-BR-BIS3WgEC.js";import"./scroll-area-C0S6gB82.js";import"./index-BdQq_4o_.js";import"./layout-dashboard-CC4g-mOh.js";import"./wallet-CKmMh37E.js";import"./users-DD1qYPM2.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=L("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=L("Unlink",[["path",{d:"m18.84 12.25 1.72-1.71h-.02a5.004 5.004 0 0 0-.12-7.07 5.006 5.006 0 0 0-6.95 0l-1.72 1.71",key:"yqzxt4"}],["path",{d:"m5.17 11.75-1.71 1.71a5.004 5.004 0 0 0 .12 7.07 5.006 5.006 0 0 0 6.95 0l1.71-1.71",key:"4qinb0"}],["line",{x1:"8",x2:"8",y1:"2",y2:"5",key:"1041cp"}],["line",{x1:"2",x2:"5",y1:"8",y2:"8",key:"14m1p5"}],["line",{x1:"16",x2:"16",y1:"19",y2:"22",key:"rzdirn"}],["line",{x1:"19",x2:"22",y1:"16",y2:"16",key:"ox905f"}]]);function ve(){const[C,F]=i.useState(""),[l,g]=i.useState(1),[t,q]=i.useState(null),[S,x]=i.useState(!1),[A,u]=i.useState(!1),[r,h]=i.useState({name:"",email:"",phone:""}),[p,v]=i.useState(null),[w,N]=i.useState(!1),{data:n,isLoading:O,refetch:y}=d.tutors.list.useQuery({page:l,limit:20,search:C||void 0}),{data:U}=d.pets.list.useQuery(),m=d.tutors.getById.useQuery({tutorId:t?.id||0},{enabled:!!t&&S}),P=d.tutors.update.useMutation({onSuccess:()=>{o.success("Tutor atualizado com sucesso!"),x(!1),y(),t&&m.refetch()},onError:s=>{o.error(`Erro ao atualizar tutor: ${s.message}`)}}),k=d.tutors.linkPet.useMutation({onSuccess:()=>{o.success("Pet vinculado com sucesso!"),u(!1),v(null),N(!1),m.refetch(),y()},onError:s=>{o.error(`Erro ao vincular pet: ${s.message}`)}}),D=d.tutors.unlinkPet.useMutation({onSuccess:()=>{o.success("Pet desvinculado com sucesso!"),m.refetch(),y()},onError:s=>{o.error(`Erro ao desvincular pet: ${s.message}`)}}),V=s=>{h({name:s.name||"",email:s.email||"",phone:s.phone||""}),q(s),x(!0)},Q=()=>{t&&P.mutate({tutorId:t.id,...r})},$=()=>{!t||!p||k.mutate({tutorId:t.id,petId:p,isPrimary:w})},G=s=>{t&&confirm("Tem certeza que deseja desvincular este pet do tutor?")&&D.mutate({tutorId:t.id,petId:s})},j=m.data,R=U?.filter(s=>!j?.linkedPets.some(W=>W.petId===s.id))||[];return e.jsx(K,{children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Gestão de Tutores"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Gerencie tutores, vincule pets e atualize informações de contato"})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-3",children:e.jsx(b,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total de Tutores"}),e.jsx("p",{className:"text-2xl font-bold",children:n?.total||0})]}),e.jsx(B,{className:"h-8 w-8 text-muted-foreground"})]})})}),e.jsx(b,{className:"p-4",children:e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Y,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(f,{placeholder:"Buscar por nome, email ou telefone...",value:C,onChange:s=>{F(s.target.value),g(1)},className:"pl-10"})]})})}),e.jsxs(b,{className:"p-6",children:[O?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Carregando tutores..."}):n?.tutors.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(B,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Nenhum tutor encontrado"})]}):e.jsx("div",{className:"space-y-4",children:n?.tutors.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-accent/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-gradient-primary flex items-center justify-center text-white font-semibold",children:s.name?.[0]||"T"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold",children:s.name||"Sem nome"}),e.jsxs("div",{className:"flex items-center gap-4 mt-1 text-sm text-muted-foreground",children:[s.email&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Z,{className:"h-3 w-3"}),s.email]}),s.phone&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(_,{className:"h-3 w-3"}),s.phone]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(H,{className:"h-3 w-3"}),"Cadastrado em ",se(new Date(s.createdAt),"dd/MM/yyyy",{locale:te})]})]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(a,{variant:"outline",size:"sm",onClick:()=>V(s),children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"Editar"]})})]},s.id))}),n&&n.total>20&&e.jsxs("div",{className:"flex items-center justify-between mt-6 pt-6 border-t",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Mostrando ",(l-1)*20+1," a ",Math.min(l*20,n.total)," de ",n.total," tutores"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(a,{variant:"outline",size:"sm",disabled:l===1,onClick:()=>g(l-1),children:"Anterior"}),e.jsx(a,{variant:"outline",size:"sm",disabled:l*20>=n.total,onClick:()=>g(l+1),children:"Próximo"})]})]})]}),e.jsx(E,{open:S,onOpenChange:x,children:e.jsxs(I,{className:"max-w-2xl",children:[e.jsx(M,{children:e.jsx(T,{children:"Editar Tutor"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"name",children:"Nome"}),e.jsx(f,{id:"name",value:r.name,onChange:s=>h({...r,name:s.target.value}),placeholder:"Nome do tutor"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"email",children:"Email"}),e.jsx(f,{id:"email",type:"email",value:r.email,onChange:s=>h({...r,email:s.target.value}),placeholder:"email@exemplo.com"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"phone",children:"Telefone (WhatsApp)"}),e.jsx(f,{id:"phone",value:r.phone,onChange:s=>h({...r,phone:s.target.value}),placeholder:"+55 11 99999-9999"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Usado para enviar lembretes automáticos de saúde"})]}),m.isLoading?e.jsx("div",{className:"text-center py-4 text-muted-foreground",children:"Carregando pets..."}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(c,{children:"Pets Vinculados"}),e.jsxs(a,{variant:"outline",size:"sm",onClick:()=>u(!0),children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Vincular Pet"]})]}),e.jsx("div",{className:"mt-2 space-y-2",children:!j?.linkedPets||j.linkedPets.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Nenhum pet vinculado"}):j.linkedPets.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(J,{className:"h-5 w-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.petName}),s.petBreed&&e.jsx("p",{className:"text-xs text-muted-foreground",children:s.petBreed})]}),s.isPrimary&&e.jsx(X,{variant:"secondary",className:"text-xs",children:"Contato Principal"})]}),e.jsx(a,{variant:"ghost",size:"sm",onClick:()=>G(s.petId),disabled:D.isPending,children:e.jsx(ne,{className:"h-4 w-4"})})]},s.petId))})]})]}),e.jsxs(z,{children:[e.jsx(a,{variant:"outline",onClick:()=>x(!1),children:"Cancelar"}),e.jsx(a,{onClick:Q,disabled:P.isPending,children:P.isPending?"Salvando...":"Salvar"})]})]})}),e.jsx(E,{open:A,onOpenChange:u,children:e.jsxs(I,{children:[e.jsx(M,{children:e.jsx(T,{children:"Vincular Pet ao Tutor"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"pet",children:"Selecione o Pet"}),e.jsxs("select",{id:"pet",className:"w-full p-2 border rounded-lg",value:p||"",onChange:s=>v(Number(s.target.value)),children:[e.jsx("option",{value:"",children:"Selecione um pet..."}),R.map(s=>e.jsxs("option",{value:s.id,children:[s.name," ",s.breed?`- ${s.breed}`:""]},s.id))]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"isPrimary",checked:w,onChange:s=>N(s.target.checked),className:"rounded"}),e.jsx(c,{htmlFor:"isPrimary",className:"cursor-pointer",children:"Definir como contato principal do pet"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"O contato principal receberá lembretes de saúde via WhatsApp"})]}),e.jsxs(z,{children:[e.jsx(a,{variant:"outline",onClick:()=>{u(!1),v(null),N(!1)},children:"Cancelar"}),e.jsx(a,{onClick:$,disabled:!p||k.isPending,children:k.isPending?"Vinculando...":"Vincular"})]})]})})]})})}export{ve as default};
