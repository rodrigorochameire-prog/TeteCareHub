import{r as y,t as h,a as v,j as e,C as r,f as i,B as p,b as n,d as l,n as q,i as z,e as D,o as A,p as Q,q as L,s as V,v as W,h as P,w as G}from"./index-DG0yx2hi.js";import{T}from"./TutorLayout-lMG2oLBz.js";import{B as I}from"./popover-Bqiz4euq.js";import{S as J,a as K,b as U,c as X,d as Y}from"./select-k5kl2mY3.js";import{W as F}from"./wallet-CKmMh37E.js";import{S as Z}from"./shopping-cart-B8qSl-rX.js";import{T as M}from"./trending-down-S1-mxyMB.js";import{C as $}from"./credit-card-CxD7Buqp.js";import{P as _}from"./package-CC5WVNv6.js";import{f as ee,p as se}from"./pt-BR-BIS3WgEC.js";import"./NotificationBell-BIuiN9Fe.js";import"./info-DReA-lTp.js";import"./message-square-COhalQ2E.js";import"./chart-column-B4FPjduw.js";import"./user-B4BzRHVK.js";import"./index-BdQq_4o_.js";import"./index-r4-iOF84.js";import"./chevron-down-CKVtRMqG.js";import"./check-DDByOptX.js";function ve(){const[o,E]=y.useState(null),[R,m]=y.useState(!1),[u,B]=y.useState("10"),{data:c}=h.pets.list.useQuery(),{data:b,refetch:k}=h.credits.getHistory.useQuery({petId:o||c?.[0]?.id||0},{enabled:!!c&&c.length>0}),{data:d}=h.credits.getTransactions.useQuery(),j=h.credits.addPackage.useMutation({onSuccess:()=>{v.success("Pacote de créditos adicionado com sucesso!"),m(!1),k()},onError:s=>{v.error("Erro ao adicionar créditos: "+s.message)}}),H=s=>{if(s.preventDefault(),!o){v.error("Selecione um pet");return}const t=new FormData(s.currentTarget),a=parseInt(t.get("amount")),x=parseFloat(t.get("price"));j.mutate({petId:o,packageDays:a,packagePrice:x})},C=[{credits:10,price:300,discount:0},{credits:20,price:550,discount:8},{credits:30,price:750,discount:17},{credits:50,price:1200,discount:20}],f=b?.reduce((s,t)=>s+t.balance,0)||0;d?.filter(s=>s.type==="expense").reduce((s,t)=>s+t.amount,0);const O=d?.filter(s=>s.type==="income").reduce((s,t)=>s+t.amount,0)||0,g=new Date;g.setDate(g.getDate()-30);const w=d?.filter(s=>s.type==="expense"&&new Date(s.transactionDate)>=g)||[],N=w.length>0?w.length/30:0,S=N>0?Math.floor(f/N):0;return!c||c.length===0?e.jsx(T,{children:e.jsx("div",{className:"space-y-6 animate-fade-in",children:e.jsx(r,{children:e.jsxs(i,{className:"empty-state",children:[e.jsx(F,{className:"empty-state-icon"}),e.jsx("p",{className:"empty-state-title",children:"Nenhum pet cadastrado"}),e.jsx("p",{className:"empty-state-description",children:"Cadastre um pet para gerenciar créditos de creche"})]})})})}):e.jsx(T,{children:e.jsxs("div",{className:"container max-w-7xl py-8 space-y-8 animate-fade-in",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Pacote de Diárias"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Gerencie os créditos de creche dos seus pets"})]}),e.jsxs(p,{onClick:()=>m(!0),className:"gap-2",size:"lg",children:[e.jsx(Z,{className:"h-5 w-5"}),"Comprar Créditos"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs(r,{className:"hover-lift",children:[e.jsxs(n,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(l,{className:"text-sm font-medium text-muted-foreground",children:"Saldo Total"}),e.jsx("div",{className:"h-10 w-10 rounded-full bg-green-100 flex items-center justify-center",children:e.jsx(F,{className:"h-5 w-5 text-green-600"})})]}),e.jsxs(i,{children:[e.jsx("div",{className:"text-3xl font-bold text-green-600",children:f}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"créditos disponíveis"})]})]}),e.jsxs(r,{className:"hover-lift",children:[e.jsxs(n,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(l,{className:"text-sm font-medium text-muted-foreground",children:"Consumo Médio"}),e.jsx("div",{className:"h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center",children:e.jsx(M,{className:"h-5 w-5 text-blue-600"})})]}),e.jsxs(i,{children:[e.jsx("div",{className:"text-3xl font-bold text-blue-600",children:N.toFixed(1)}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"créditos por dia"})]})]}),e.jsxs(r,{className:"hover-lift",children:[e.jsxs(n,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(l,{className:"text-sm font-medium text-muted-foreground",children:"Previsão"}),e.jsx("div",{className:"h-10 w-10 rounded-full bg-orange-100 flex items-center justify-center",children:e.jsx(q,{className:"h-5 w-5 text-orange-600"})})]}),e.jsxs(i,{children:[e.jsx("div",{className:"text-3xl font-bold text-orange-600",children:S>0?S:"—"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"dias restantes"})]})]}),e.jsxs(r,{className:"hover-lift",children:[e.jsxs(n,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(l,{className:"text-sm font-medium text-muted-foreground",children:"Total Investido"}),e.jsx("div",{className:"h-10 w-10 rounded-full bg-purple-100 flex items-center justify-center",children:e.jsx($,{className:"h-5 w-5 text-purple-600"})})]}),e.jsxs(i,{children:[e.jsxs("div",{className:"text-3xl font-bold text-purple-600",children:["R$ ",O.toFixed(2)]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"em pacotes"})]})]})]}),f<5&&e.jsxs(r,{className:"border-orange-200 bg-orange-50/50",children:[e.jsx(n,{children:e.jsxs(l,{className:"text-orange-900 flex items-center gap-2",children:[e.jsx(z,{className:"h-5 w-5"}),"Créditos Baixos"]})}),e.jsxs(i,{children:[e.jsx("p",{className:"text-orange-800",children:"Seus créditos estão acabando! Recomendamos comprar um novo pacote para garantir que seu pet continue frequentando a creche sem interrupções."}),e.jsx(p,{onClick:()=>m(!0),className:"mt-4",variant:"default",children:"Comprar Agora"})]})]}),e.jsxs(r,{children:[e.jsxs(n,{children:[e.jsx(l,{children:"Saldo por Pet"}),e.jsx(D,{children:"Créditos disponíveis para cada pet"})]}),e.jsx(i,{children:e.jsx("div",{className:"space-y-4",children:b?.map(s=>{const t=c.find(x=>x.id===s.petId),a=s.balance/(s.balance+10)*100;return e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:t?.name}),e.jsxs(I,{variant:s.balance>5?"default":"destructive",children:[s.balance," créditos"]})]}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[a.toFixed(0),"%"]})]}),e.jsx("div",{className:"h-2 bg-secondary rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full transition-all ${s.balance>10?"bg-green-500":s.balance>5?"bg-yellow-500":"bg-red-500"}`,style:{width:`${Math.min(a,100)}%`}})})]})},s.id)})})})]}),e.jsxs(r,{children:[e.jsxs(n,{children:[e.jsx(l,{children:"Histórico de Transações"}),e.jsx(D,{children:"Compras e consumos de créditos"})]}),e.jsx(i,{children:e.jsx("div",{className:"space-y-3",children:d&&d.length>0?d.slice(0,10).map(s=>{const t=c.find(x=>x.id===s.petId),a=s.type==="income";return e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg border hover:bg-accent transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`h-10 w-10 rounded-full flex items-center justify-center ${a?"bg-green-100":"bg-red-100"}`,children:a?e.jsx(_,{className:"h-5 w-5 text-green-600"}):e.jsx(M,{className:"h-5 w-5 text-red-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:a?"Compra de Pacote":"Consumo de Crédito"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[t?.name," • ",ee(new Date(s.transactionDate),"dd 'de' MMMM 'de' yyyy",{locale:se})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:`font-bold ${a?"text-green-600":"text-red-600"}`,children:[a?"+":"-",Math.abs(s.amount)]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["R$ ",s.amount.toFixed(2)]})]})]},s.id)}):e.jsxs("div",{className:"empty-state py-8",children:[e.jsx($,{className:"empty-state-icon"}),e.jsx("p",{className:"empty-state-title",children:"Nenhuma transação"}),e.jsx("p",{className:"empty-state-description",children:"Compre seu primeiro pacote de créditos"})]})})})]}),e.jsx(A,{open:R,onOpenChange:m,children:e.jsxs(Q,{className:"max-w-2xl",children:[e.jsxs(L,{children:[e.jsx(V,{children:"Comprar Pacote de Créditos"}),e.jsx(W,{children:"Escolha um pacote e o pet para adicionar créditos"})]}),e.jsxs("form",{onSubmit:H,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{children:"Selecione o Pet"}),e.jsxs(J,{value:o?.toString(),onValueChange:s=>E(parseInt(s)),children:[e.jsx(K,{children:e.jsx(U,{placeholder:"Escolha um pet"})}),e.jsx(X,{children:c.map(s=>e.jsx(Y,{value:s.id.toString(),children:s.name},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{children:"Escolha um Pacote"}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:C.map(s=>e.jsx(r,{className:`cursor-pointer transition-all hover-lift ${u===s.credits.toString()?"border-primary ring-2 ring-primary":""}`,onClick:()=>B(s.credits.toString()),children:e.jsx(i,{className:"p-6",children:e.jsxs("div",{className:"text-center space-y-2",children:[s.discount>0&&e.jsxs(I,{variant:"secondary",className:"mb-2",children:[s.discount,"% OFF"]}),e.jsx("div",{className:"text-3xl font-bold",children:s.credits}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"créditos"}),e.jsxs("div",{className:"text-2xl font-bold text-primary",children:["R$ ",s.price.toFixed(2)]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["R$ ",(s.price/s.credits).toFixed(2)," por crédito"]})]})})},s.credits))})]}),e.jsx("input",{type:"hidden",name:"amount",value:u}),e.jsx("input",{type:"hidden",name:"price",value:C.find(s=>s.credits.toString()===u)?.price||0}),e.jsxs(G,{children:[e.jsx(p,{type:"button",variant:"outline",onClick:()=>m(!1),children:"Cancelar"}),e.jsx(p,{type:"submit",disabled:!o||j.isPending,children:j.isPending?"Processando...":"Confirmar Compra"})]})]})]})})]})})}export{ve as default};
