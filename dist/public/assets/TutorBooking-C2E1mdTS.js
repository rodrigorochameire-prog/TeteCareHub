import{r as j,t as N,a as g,j as e,l as k,C as A,b as E,d as z,e as q,f as O,B as v,i as ce,n as oe,c as me}from"./index-DG0yx2hi.js";import{T as W}from"./TutorLayout-lMG2oLBz.js";import{T as xe}from"./textarea-BfRN5q_Y.js";import{S as X,a as _,b as G,c as J,d as $}from"./select-k5kl2mY3.js";import{B as b}from"./popover-Bqiz4euq.js";import{n as he,c as ue,t as pe,f as x,s as K,p as U}from"./pt-BR-BIS3WgEC.js";import{C as w}from"./circle-x-Ewhe70CR.js";import{C as je}from"./clock-BQzFMz2h.js";import{s as Y,e as Z,a as B,i as S}from"./startOfMonth-Dgqj6bpG.js";import"./NotificationBell-BIuiN9Fe.js";import"./info-DReA-lTp.js";import"./message-square-COhalQ2E.js";import"./chart-column-B4FPjduw.js";import"./package-CC5WVNv6.js";import"./user-B4BzRHVK.js";import"./index-BdQq_4o_.js";import"./index-r4-iOF84.js";import"./chevron-down-CKVtRMqG.js";import"./check-DDByOptX.js";function ge(i,h){const[t,d]=he(i,h.start,h.end);return{start:t,end:d}}function ee(i,h){const{start:t,end:d}=ge(h?.in,i);let c=+t>+d;const C=c?+t:+d,n=c?d:t;n.setHours(0,0,0,0);let D=1;const f=[];for(;+n<=C;)f.push(ue(t,n)),n.setDate(n.getDate()+D),n.setHours(0,0,0,0);return c?f.reverse():f}function se(i){return+pe(i)<Date.now()}function Be(){const[i,h]=j.useState(new Date),[t,d]=j.useState([]),[c,C]=j.useState(null),[n,D]=j.useState("creche"),[f,L]=j.useState(""),{data:F,isLoading:ae}=N.pets.list.useQuery(),{data:M,isLoading:te,refetch:H}=N.bookingRequests.myRequests.useQuery(),I=j.useMemo(()=>{const s=Y(i),a=Z(i);return ee({start:s,end:a}).map(r=>x(r,"yyyy-MM-dd"))},[i]),{data:re}=N.bookingRequests.getAvailability.useQuery({dates:I},{enabled:I.length>0}),P=N.bookingRequests.create.useMutation({onSuccess:()=>{g.success("Solicitação enviada! Aguardando aprovação do administrador."),d([]),L(""),H()},onError:s=>{g.error("Erro ao enviar solicitação: "+s.message)}}),R=N.bookingRequests.cancel.useMutation({onSuccess:()=>{g.success("Solicitação cancelada com sucesso."),H()},onError:s=>{g.error("Erro ao cancelar: "+s.message)}}),y=F?.find(s=>s.id===c),ie=j.useMemo(()=>{const s=Y(i),a=Z(i),l=ee({start:s,end:a}),r=s.getDay(),T=Array.from({length:r},(o,p)=>({date:B(s,-(r-p)),isCurrentMonth:!1})),u=l.map(o=>({date:o,isCurrentMonth:!0}));return[...T,...u]},[i]),ne=s=>{const a=x(s,"yyyy-MM-dd");return re?.find(l=>l.date===a)},Q=s=>t.some(a=>S(a,s)),V=s=>{if(se(K(s))&&!S(s,new Date)){g.error("Não é possível selecionar datas passadas.");return}Q(s)?d(a=>a.filter(l=>!S(l,s))):d(a=>[...a,s])},le=()=>{if(!c){g.error("Por favor, selecione o pet para a reserva.");return}if(t.length===0){g.error("Por favor, selecione pelo menos uma data.");return}P.mutate({petId:c,requestedDates:t.map(s=>x(s,"yyyy-MM-dd")),notes:f})},de=s=>{switch(s){case"pending":return e.jsxs(b,{variant:"outline",className:"bg-yellow-50 text-yellow-700 border-yellow-200",children:[e.jsx(je,{className:"w-3 h-3 mr-1"}),"Pendente"]});case"approved":return e.jsxs(b,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:[e.jsx(me,{className:"w-3 h-3 mr-1"}),"Aprovada"]});case"rejected":return e.jsxs(b,{variant:"outline",className:"bg-red-50 text-red-700 border-red-200",children:[e.jsx(w,{className:"w-3 h-3 mr-1"}),"Rejeitada"]});case"cancelled":return e.jsxs(b,{variant:"outline",className:"bg-gray-50 text-gray-700 border-gray-200",children:[e.jsx(w,{className:"w-3 h-3 mr-1"}),"Cancelada"]});default:return null}};return ae||te?e.jsx(W,{children:e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx(k,{className:"w-8 h-8 animate-spin text-primary"})})}):e.jsx(W,{children:e.jsxs("div",{className:"container py-8 space-y-8 animate-fade-in",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Agendamento Online"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Selecione as datas desejadas para reservar dias de creche para seu pet"})]}),e.jsxs("div",{className:"grid gap-8 lg:grid-cols-3",children:[e.jsx("div",{className:"lg:col-span-2 space-y-6",children:e.jsxs(A,{children:[e.jsxs(E,{children:[e.jsx(z,{children:"Selecione as Datas"}),e.jsx(q,{children:"Clique nas datas disponíveis para adicionar à sua reserva"})]}),e.jsxs(O,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx(v,{variant:"outline",size:"sm",onClick:()=>h(s=>B(s,-30)),children:"← Anterior"}),e.jsx("h3",{className:"text-lg font-semibold capitalize",children:x(i,"MMMM yyyy",{locale:U})}),e.jsx(v,{variant:"outline",size:"sm",onClick:()=>h(s=>B(s,30)),children:"Próximo →"})]}),e.jsxs("div",{className:"grid grid-cols-7 gap-2",children:[["Dom","Seg","Ter","Qua","Qui","Sex","Sáb"].map(s=>e.jsx("div",{className:"text-center text-sm font-medium text-muted-foreground py-2",children:s},s)),ie.map(({date:s,isCurrentMonth:a},l)=>{const r=ne(s),T=Q(s),u=se(K(s))&&!S(s,new Date);let o="bg-white hover:bg-gray-50",p="border-gray-200",m="text-gray-900";return a||(m="text-gray-400"),u?(o="bg-gray-100",m="text-gray-400"):T?(o="bg-primary text-primary-foreground",p="border-primary",m="text-primary-foreground"):r&&(r.status==="full"?(o="bg-red-50 hover:bg-red-100",p="border-red-200",m="text-red-700"):r.status==="limited"?(o="bg-yellow-50 hover:bg-yellow-100",p="border-yellow-200",m="text-yellow-700"):(o="bg-green-50 hover:bg-green-100",p="border-green-200",m="text-green-700")),e.jsxs("button",{onClick:()=>a&&!u&&r?.status!=="full"&&V(s),disabled:!a||u||r?.status==="full",className:`
                          aspect-square p-2 rounded-lg border transition-all
                          ${o} ${p} ${m}
                          ${a&&!u&&r?.status!=="full"?"cursor-pointer":"cursor-not-allowed"}
                          disabled:opacity-50
                        `,children:[e.jsx("div",{className:"text-sm font-medium",children:x(s,"d")}),r&&a&&!u&&e.jsxs("div",{className:"text-xs mt-1",children:[r.available,"/",r.maxCapacity]})]},l)})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 mt-6 pt-6 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-green-100 border border-green-200"}),e.jsx("span",{className:"text-sm",children:"Disponível"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-yellow-100 border border-yellow-200"}),e.jsx("span",{className:"text-sm",children:"Vagas limitadas"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-red-100 border border-red-200"}),e.jsx("span",{className:"text-sm",children:"Lotado"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-primary"}),e.jsx("span",{className:"text-sm",children:"Selecionado"})]})]})]})]})}),e.jsx("div",{className:"space-y-6",children:e.jsxs(A,{children:[e.jsx(E,{children:e.jsx(z,{children:"Detalhes da Reserva"})}),e.jsxs(O,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Tipo de Serviço"}),e.jsxs(X,{value:n,onValueChange:s=>D(s),children:[e.jsx(_,{children:e.jsx(G,{})}),e.jsxs(J,{children:[e.jsx($,{value:"creche",children:e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("span",{className:"font-medium",children:"Creche (R$ 60/dia)"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Sem pernoite - 8h às 18h"})]})}),e.jsx($,{value:"diaria",children:e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("span",{className:"font-medium",children:"Diária com Pernoite (R$ 80/dia)"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Com pernoite - 24h completas"})]})})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Pet"}),e.jsxs(X,{value:c?.toString()||"",onValueChange:s=>C(Number(s)),children:[e.jsx(_,{children:e.jsx(G,{placeholder:"Selecione o pet"})}),e.jsx(J,{children:F?.map(s=>e.jsxs($,{value:s.id.toString(),children:[s.name," (",s.credits," créditos)"]},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Datas Selecionadas"}),t.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"Nenhuma data selecionada"}):e.jsx("div",{className:"space-y-1",children:t.sort((s,a)=>s.getTime()-a.getTime()).map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between text-sm bg-muted px-3 py-2 rounded",children:[e.jsx("span",{className:"capitalize",children:x(s,"dd/MM/yyyy (EEEE)",{locale:U})}),e.jsx(v,{variant:"ghost",size:"sm",onClick:()=>V(s),children:e.jsx(w,{className:"w-4 h-4"})})]},a))})]}),t.length>0&&e.jsxs("div",{className:"p-4 bg-gradient-to-br from-primary/5 to-primary/10 border border-primary/20 rounded-lg space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium",children:"Tipo de serviço:"}),e.jsx("span",{className:"font-bold",children:n==="creche"?"Creche":"Diária com Pernoite"})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium",children:"Preço unitário:"}),e.jsxs("span",{className:"font-bold",children:["R$ ",n==="creche"?"60,00":"80,00"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium",children:"Quantidade de dias:"}),e.jsx("span",{className:"font-bold",children:t.length})]}),e.jsx("div",{className:"h-px bg-primary/20 my-2"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-base",children:"Valor Total:"}),e.jsxs("span",{className:"font-bold text-xl text-primary",children:["R$ ",((n==="creche"?60:80)*t.length).toFixed(2).replace(".",",")]})]})]}),y&&e.jsxs("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium",children:"Créditos necessários:"}),e.jsx("span",{className:"font-bold",children:t.length})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm mt-1",children:[e.jsx("span",{className:"font-medium",children:"Créditos disponíveis:"}),e.jsx("span",{className:y.credits>=t.length?"text-green-600 font-bold":"text-red-600 font-bold",children:y.credits})]}),y.credits<t.length&&e.jsxs("div",{className:"flex items-start gap-2 mt-2 text-xs text-red-600",children:[e.jsx(ce,{className:"w-4 h-4 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:"Créditos insuficientes. Adquira mais créditos antes de solicitar a reserva."})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Observações (opcional)"}),e.jsx(xe,{value:f,onChange:s=>L(s.target.value),placeholder:"Adicione observações sobre a reserva...",rows:3})]}),e.jsx(v,{className:"w-full",onClick:le,disabled:!c||t.length===0||y&&y.credits<t.length||P.isPending,children:P.isPending?e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"w-4 h-4 mr-2 animate-spin"}),"Enviando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),"Solicitar Reserva"]})})]})]})})]}),e.jsxs(A,{children:[e.jsxs(E,{children:[e.jsx(z,{children:"Minhas Solicitações"}),e.jsx(q,{children:"Histórico de solicitações de reserva"})]}),e.jsx(O,{children:!M||M.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"Você ainda não fez nenhuma solicitação de reserva"}):e.jsx("div",{className:"space-y-4",children:M.map(s=>e.jsxs("div",{className:"border rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[s.petPhoto&&e.jsx("img",{src:s.petPhoto,alt:s.petName||"Pet",className:"w-12 h-12 rounded-full object-cover"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:s.petName}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Solicitado em ",x(new Date(s.createdAt),"dd/MM/yyyy HH:mm")]})]})]}),de(s.status)]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Datas solicitadas:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.requestedDates.map((a,l)=>e.jsx(b,{variant:"secondary",children:x(new Date(a),"dd/MM/yyyy")},l))})]}),s.notes&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Observações:"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.notes})]}),s.adminNotes&&e.jsxs("div",{className:"bg-muted p-3 rounded",children:[e.jsx("p",{className:"text-sm font-medium",children:"Resposta do administrador:"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.adminNotes})]}),s.status==="pending"&&e.jsx(v,{variant:"outline",size:"sm",onClick:()=>R.mutate({id:s.id}),disabled:R.isPending,children:R.isPending?e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"w-4 h-4 mr-2 animate-spin"}),"Cancelando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"w-4 h-4 mr-2"}),"Cancelar Solicitação"]})})]},s.id))})})]})]})})}export{Be as default};
