import{r as p,t as N,j as e,C as a,b as c,d,f as i,I as E,e as L,B as P,a as v}from"./index-DG0yx2hi.js";import{A as b}from"./AdminLayout-CapzJ-JK.js";import{B as g}from"./popover-Bqiz4euq.js";import{S as q}from"./switch-DwIsyt3g.js";import{U as C}from"./users-DD1qYPM2.js";import{S as w}from"./shield-alert-TzURb-V9.js";import{C as D}from"./check-DDByOptX.js";import{S as G}from"./search-DtaYG9vz.js";import"./scroll-area-C0S6gB82.js";import"./index-BdQq_4o_.js";import"./layout-dashboard-CC4g-mOh.js";import"./wallet-CKmMh37E.js";import"./user-B4BzRHVK.js";import"./index-r4-iOF84.js";const M=[{value:"vaccine_reminder_7d",label:"Lembrete de Vacina (7 dias)"},{value:"vaccine_reminder_1d",label:"Lembrete de Vacina (1 dia)"},{value:"medication_reminder",label:"Lembrete de Medicamento"},{value:"checkin_notification",label:"Notificação de Check-in"},{value:"checkout_notification",label:"Notificação de Check-out"},{value:"daily_report",label:"Relatório Diário"},{value:"credits_low",label:"Créditos Baixos"},{value:"event_reminder",label:"Lembrete de Evento"}];function ee(){const[l,y]=p.useState(""),[o,T]=p.useState(null),{data:x,isLoading:I,refetch:O}=N.tutorPreferences.getAll.useQuery(),h=N.tutorPreferences.adminOverride.useMutation(),S=async(s,t,r)=>{try{await h.mutateAsync({tutorId:s,notificationType:t,adminOverride:r}),v.success(r?"Notificação bloqueada para este tutor":"Bloqueio removido"),O()}catch(n){v.error(n.message||"Erro ao atualizar preferência")}};if(I)return e.jsx(b,{children:e.jsx("div",{className:"container max-w-7xl py-8 animate-fade-in",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("p",{className:"text-muted-foreground",children:"Carregando preferências..."})})})});const _=x?.reduce((s,t)=>{const r=t.tutorId;return s[r]||(s[r]={tutorId:t.tutorId,tutorName:t.tutorName||"Sem nome",tutorEmail:t.tutorEmail||"",preferences:[]}),s[r].preferences.push(t),s},{}),m=Object.values(_||{}),f=m.filter(s=>s.tutorName.toLowerCase().includes(l.toLowerCase())||s.tutorEmail.toLowerCase().includes(l.toLowerCase())),k=m.length,A=m.filter(s=>s.preferences.some(t=>t.adminOverride)).length,B=x?.length||0;return e.jsx(b,{children:e.jsxs("div",{className:"container max-w-7xl py-8 animate-fade-in",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Preferências de Notificações por Tutor"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Gerencie quais notificações cada tutor pode receber"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsxs(a,{children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium",children:"Total de Tutores"}),e.jsx(C,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(i,{children:e.jsx("div",{className:"text-2xl font-bold",children:k})})]}),e.jsxs(a,{children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium",children:"Com Bloqueios Admin"}),e.jsx(w,{className:"h-4 w-4 text-orange-600"})]}),e.jsx(i,{children:e.jsx("div",{className:"text-2xl font-bold",children:A})})]}),e.jsxs(a,{children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(d,{className:"text-sm font-medium",children:"Total de Preferências"}),e.jsx(D,{className:"h-4 w-4 text-green-600"})]}),e.jsx(i,{children:e.jsx("div",{className:"text-2xl font-bold",children:B})})]})]}),e.jsx(a,{className:"mb-6",children:e.jsx(i,{className:"pt-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(G,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(E,{placeholder:"Buscar tutor por nome ou email...",value:l,onChange:s=>y(s.target.value),className:"pl-10"})]})})}),e.jsxs("div",{className:"space-y-6",children:[f.length===0&&e.jsx(a,{children:e.jsxs(i,{className:"flex flex-col items-center justify-center h-64",children:[e.jsx(C,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground text-center",children:l?"Nenhum tutor encontrado com este termo de busca.":"Nenhum tutor com preferências cadastradas."})]})}),f.map(s=>e.jsxs(a,{className:"hover-lift",children:[e.jsx(c,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx(d,{children:s.tutorName}),e.jsx(L,{children:s.tutorEmail})]}),e.jsx(P,{variant:"outline",size:"sm",onClick:()=>T(o===s.tutorId?null:s.tutorId),children:o===s.tutorId?"Ocultar":"Gerenciar"})]})}),o===s.tutorId&&e.jsx(i,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm font-medium mb-4",children:"Configurações de Notificações:"}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:M.map(t=>{const r=s.preferences.find(u=>u.notificationType===t.value),n=r?r.enabled:!0,j=r?.adminOverride||!1;return e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:t.label}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(g,{variant:n?"default":"secondary",children:n?"Habilitado":"Desabilitado"}),j&&e.jsxs(g,{variant:"destructive",children:[e.jsx(w,{className:"h-3 w-3 mr-1"}),"Bloqueado pelo Admin"]})]})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Bloquear:"}),e.jsx(q,{checked:j,onCheckedChange:u=>S(s.tutorId,t.value,u),disabled:h.isPending})]})})]},t.value)})})]})})]},s.tutorId))]})]})})}export{ee as default};
